<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Titanic - studies on classification | Data Science and Tidymodels</title>
  <meta name="description" content="Chapter 3 Titanic - studies on classification | Data Science and Tidymodels" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Titanic - studies on classification | Data Science and Tidymodels" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://dswtmsc.netlify.app/index.html" />
  
  
  <meta name="github-repo" content="https://github.com/Bjarnelp/Data_Science_Tidymodels" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Titanic - studies on classification | Data Science and Tidymodels" />
  
  
  

<meta name="author" content="Bjarne Lund Pedersen" />


<meta name="date" content="2022-03-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="machine-learning-capstone-project.html"/>
<link rel="next" href="ames-housing-data---regression-methods.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Science and Tidymodels</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> cover-image: path to the social sharing image like images/cover.jpg</a></li>
<li class="chapter" data-level="2" data-path="machine-learning-capstone-project.html"><a href="machine-learning-capstone-project.html"><i class="fa fa-check"></i><b>2</b> Machine Learning Capstone Project</a>
<ul>
<li class="chapter" data-level="2.1" data-path="machine-learning-capstone-project.html"><a href="machine-learning-capstone-project.html#data-collection"><i class="fa fa-check"></i><b>2.1</b> Data Collection</a></li>
<li class="chapter" data-level="2.2" data-path="machine-learning-capstone-project.html"><a href="machine-learning-capstone-project.html#data-wrangling"><i class="fa fa-check"></i><b>2.2</b> Data Wrangling</a></li>
<li class="chapter" data-level="2.3" data-path="machine-learning-capstone-project.html"><a href="machine-learning-capstone-project.html#eda-with-visualizations"><i class="fa fa-check"></i><b>2.3</b> EDA with Visualizations</a></li>
<li class="chapter" data-level="2.4" data-path="machine-learning-capstone-project.html"><a href="machine-learning-capstone-project.html#interactive-visual-analytics"><i class="fa fa-check"></i><b>2.4</b> Interactive Visual Analytics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="machine-learning-capstone-project.html"><a href="machine-learning-capstone-project.html#map-data-with-leaflet"><i class="fa fa-check"></i><b>2.4.1</b> Map data with Leaflet</a></li>
<li class="chapter" data-level="2.4.2" data-path="machine-learning-capstone-project.html"><a href="machine-learning-capstone-project.html#dashboard-for-further-visual-eda"><i class="fa fa-check"></i><b>2.4.2</b> Dashboard for further visual EDA</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="machine-learning-capstone-project.html"><a href="machine-learning-capstone-project.html#machine-learning-models"><i class="fa fa-check"></i><b>2.5</b> Machine Learning Models</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="machine-learning-capstone-project.html"><a href="machine-learning-capstone-project.html#logistic-regression"><i class="fa fa-check"></i><b>2.5.1</b> Logistic regression</a></li>
<li class="chapter" data-level="2.5.2" data-path="machine-learning-capstone-project.html"><a href="machine-learning-capstone-project.html#support-vector-machines-svm"><i class="fa fa-check"></i><b>2.5.2</b> Support Vector Machines (SVM)</a></li>
<li class="chapter" data-level="2.5.3" data-path="machine-learning-capstone-project.html"><a href="machine-learning-capstone-project.html#knn-classifier"><i class="fa fa-check"></i><b>2.5.3</b> kNN classifier</a></li>
<li class="chapter" data-level="2.5.4" data-path="machine-learning-capstone-project.html"><a href="machine-learning-capstone-project.html#decision-tree-classifier"><i class="fa fa-check"></i><b>2.5.4</b> Decision tree classifier</a></li>
<li class="chapter" data-level="2.5.5" data-path="machine-learning-capstone-project.html"><a href="machine-learning-capstone-project.html#outro"><i class="fa fa-check"></i><b>2.5.5</b> Outro</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="titanic---studies-on-classification.html"><a href="titanic---studies-on-classification.html"><i class="fa fa-check"></i><b>3</b> Titanic - studies on classification</a>
<ul>
<li class="chapter" data-level="3.1" data-path="titanic---studies-on-classification.html"><a href="titanic---studies-on-classification.html#data-collection-and-cleaning"><i class="fa fa-check"></i><b>3.1</b> Data collection and cleaning</a></li>
<li class="chapter" data-level="3.2" data-path="titanic---studies-on-classification.html"><a href="titanic---studies-on-classification.html#eda"><i class="fa fa-check"></i><b>3.2</b> EDA</a></li>
<li class="chapter" data-level="3.3" data-path="titanic---studies-on-classification.html"><a href="titanic---studies-on-classification.html#modelling"><i class="fa fa-check"></i><b>3.3</b> Modelling</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="titanic---studies-on-classification.html"><a href="titanic---studies-on-classification.html#logistic-regression-1"><i class="fa fa-check"></i><b>3.3.1</b> Logistic Regression</a></li>
<li class="chapter" data-level="3.3.2" data-path="titanic---studies-on-classification.html"><a href="titanic---studies-on-classification.html#lda"><i class="fa fa-check"></i><b>3.3.2</b> LDA</a></li>
<li class="chapter" data-level="3.3.3" data-path="titanic---studies-on-classification.html"><a href="titanic---studies-on-classification.html#knn"><i class="fa fa-check"></i><b>3.3.3</b> kNN</a></li>
<li class="chapter" data-level="3.3.4" data-path="titanic---studies-on-classification.html"><a href="titanic---studies-on-classification.html#svm"><i class="fa fa-check"></i><b>3.3.4</b> SVM</a></li>
<li class="chapter" data-level="3.3.5" data-path="titanic---studies-on-classification.html"><a href="titanic---studies-on-classification.html#classification-trees-c5.0"><i class="fa fa-check"></i><b>3.3.5</b> Classification trees: C5.0</a></li>
<li class="chapter" data-level="3.3.6" data-path="titanic---studies-on-classification.html"><a href="titanic---studies-on-classification.html#bagged-tree-models-bagged-c5.0-and-random-forests"><i class="fa fa-check"></i><b>3.3.6</b> Bagged tree models: Bagged C5.0 and Random Forests</a></li>
<li class="chapter" data-level="3.3.7" data-path="titanic---studies-on-classification.html"><a href="titanic---studies-on-classification.html#boosted-tree-models-xgboost."><i class="fa fa-check"></i><b>3.3.7</b> Boosted tree models: XGBoost.</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="titanic---studies-on-classification.html"><a href="titanic---studies-on-classification.html#improved-model-for-titanic-data"><i class="fa fa-check"></i><b>3.4</b> Improved model for Titanic data</a></li>
<li class="chapter" data-level="3.5" data-path="titanic---studies-on-classification.html"><a href="titanic---studies-on-classification.html#summary"><i class="fa fa-check"></i><b>3.5</b> Summary</a></li>
<li class="chapter" data-level="3.6" data-path="titanic---studies-on-classification.html"><a href="titanic---studies-on-classification.html#shiny-classification-app"><i class="fa fa-check"></i><b>3.6</b> Shiny classification app</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ames-housing-data---regression-methods.html"><a href="ames-housing-data---regression-methods.html"><i class="fa fa-check"></i><b>4</b> Ames Housing Data - regression methods</a></li>
<li class="chapter" data-level="5" data-path="store-sales---time-series-prediction.html"><a href="store-sales---time-series-prediction.html"><i class="fa fa-check"></i><b>5</b> Store Sales - Time Series Prediction</a></li>
<li class="chapter" data-level="6" data-path="petals-to-the-metal---image-classification-using-tensorflow.html"><a href="petals-to-the-metal---image-classification-using-tensorflow.html"><i class="fa fa-check"></i><b>6</b> Petals to the Metal - Image Classification using tensorflow</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science and Tidymodels</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="titanic---studies-on-classification" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Titanic - studies on classification</h1>
<p>In this chapter we will turn our focus to classification techniques. The data set used will be the Kaggle data set <em>Titanic</em>.</p>
<p>The first section will focus on data collection and data wrangling. The second section has its focus on EDA. In the third and last section we will study the following classification models and how to optimize them for the dataset: Logistic Regression, LDA, kNN, SVM, XGBoost and lightGBM.</p>
<p>The evaluation metric will be the Kaggle score for each model.</p>
<div id="data-collection-and-cleaning" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Data collection and cleaning</h2>
<p>The data was downloaded from (Kaggle)[<a href="https://www.kaggle.com/c/titanic" class="uri">https://www.kaggle.com/c/titanic</a>]. The data set is made up of two parts. Part 1 is a training set for supervised learning. Part 2 is a test set, where the outcome column has been removed.</p>
<p>We will begin by loading the two data files and have a look at the data types of each column:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="titanic---studies-on-classification.html#cb1-1" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./titanic_train.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 891 Columns: 12
## ── Column specification ───────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (5): Name, Sex, Ticket, Cabin, Embarked
## dbl (7): PassengerId, Survived, Pclass, Age, SibSp, Parch, Fare
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="titanic---studies-on-classification.html#cb3-1" aria-hidden="true" tabindex="-1"></a>titanic_test <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./titanic_test.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 418 Columns: 11
## ── Column specification ───────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (5): Name, Sex, Ticket, Cabin, Embarked
## dbl (6): PassengerId, Pclass, Age, SibSp, Parch, Fare
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>We see that the training data is comprised of 891 observation of 12 features, whereas the test data is comprised of 418 observations of 11 features.</p>
<p>We have 5 features coded as charaters: Name, Sex, Ticket, Cabin, Embarked.</p>
<p>We have 6 numeric features: PassengerId, Pclass, Age, SibSp. Parch, Fare.</p>
<p>Let us first see if we need to deal with missing values:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="titanic---studies-on-classification.html#cb5-1" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="titanic---studies-on-classification.html#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">which</span>(<span class="fu">colSums</span>(<span class="fu">is.na</span>(.))<span class="sc">&gt;</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="titanic---studies-on-classification.html#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.)))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##     Age Cabin Embarked
##   &lt;int&gt; &lt;int&gt;    &lt;int&gt;
## 1   177   687        2</code></pre>
<p>We see that most of the cabin data is missing. We will not deal with these for now, but drop the column, when doing the actual modelling later.</p>
<p>For embarked we will replace the missing values with the mode. We start by determining the mode:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="titanic---studies-on-classification.html#cb7-1" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Embarked) <span class="sc">%&gt;%</span> <span class="fu">count</span>() <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
## # Groups:   Embarked [4]
##   Embarked     n
##   &lt;chr&gt;    &lt;int&gt;
## 1 S          644
## 2 C          168
## 3 Q           77
## 4 &lt;NA&gt;         2</code></pre>
<p>Then we replace the NAs by “S”:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="titanic---studies-on-classification.html#cb9-1" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="ot">&lt;-</span> titanic_train <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Embarked =</span> <span class="fu">replace</span>(Embarked,<span class="fu">is.na</span>(Embarked),<span class="st">&quot;S&quot;</span>))</span></code></pre></div>
<p>Next, let’s have a look at the distribution of age:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="titanic---studies-on-classification.html#cb10-1" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="sc">%&gt;%</span> <span class="fu">count</span>(<span class="at">Age_interval =</span> <span class="fu">cut_interval</span>(Age,<span class="at">n=</span><span class="dv">6</span>))</span></code></pre></div>
<pre><code>## # A tibble: 7 × 2
##   Age_interval     n
##   &lt;fct&gt;        &lt;int&gt;
## 1 [0.42,13.7]     71
## 2 (13.7,26.9]    248
## 3 (26.9,40.2]    245
## 4 (40.2,53.5]    100
## 5 (53.5,66.7]     43
## 6 (66.7,80]        7
## 7 &lt;NA&gt;           177</code></pre>
<p>We get see that Age seems right skewed. To verify this we calculate the skewness using the {moments} package:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="titanic---studies-on-classification.html#cb12-1" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="sc">%&gt;%</span> <span class="fu">select</span>(Age) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(.)) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Skewness =</span> moments<span class="sc">::</span><span class="fu">skewness</span>(.))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   Skewness
##      &lt;dbl&gt;
## 1    0.388</code></pre>
<p>With the right skewed age data we choose to impute the missing values in Age column with the median.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="titanic---studies-on-classification.html#cb14-1" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="ot">&lt;-</span> titanic_train <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Age =</span> <span class="fu">replace</span>(Age,<span class="fu">is.na</span>(Age),<span class="fu">median</span>(Age,<span class="at">na.rm=</span><span class="cn">TRUE</span>)))</span></code></pre></div>
<p>With this we conclude the data collection and preparation process and move on to the EDA.</p>
</div>
<div id="eda" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> EDA</h2>
<p>Lets begin by looking at the prior distrubution of survivals:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="titanic---studies-on-classification.html#cb15-1" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="titanic---studies-on-classification.html#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survived =</span> <span class="fu">as_factor</span>(Survived)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="titanic---studies-on-classification.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survived =</span> <span class="fu">fct_recode</span>(Survived, <span class="st">&quot;Died&quot;</span><span class="ot">=</span><span class="st">&quot;0&quot;</span>,<span class="st">&quot;Survived&quot;</span><span class="ot">=</span><span class="st">&quot;1&quot;</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb15-4"><a href="titanic---studies-on-classification.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Survived,<span class="at">fill=</span>Survived)) <span class="sc">+</span></span>
<span id="cb15-5"><a href="titanic---studies-on-classification.html#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb15-6"><a href="titanic---studies-on-classification.html#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Survival Status&quot;</span>, <span class="at">y=</span><span class="st">&quot;Passenger Count&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Distribution of passenger status&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-58-1.png" width="672" />
We see that roughly 3 of 5 died in the Titanic disaster. We now turn our attention to finding reasonable correlations in the data. A place to start would be a correlation diagram. We can choose to look only at the numerical features in the data set:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="titanic---studies-on-classification.html#cb16-1" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="titanic---studies-on-classification.html#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">which</span>(<span class="fu">sapply</span>(.,is.numeric))) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="titanic---studies-on-classification.html#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">correlate</span>(<span class="at">diagonal =</span> <span class="dv">1</span>,<span class="at">quiet=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="titanic---studies-on-classification.html#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rplot</span>() <span class="sc">+</span></span>
<span id="cb16-5"><a href="titanic---studies-on-classification.html#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">x=</span><span class="fu">guide_axis</span>(<span class="at">angle=</span><span class="dv">90</span>))</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type noquote. Defaulting to continuous.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-59-1.png" width="672" />
Alternatively we can one hot encode the relevant categorical variables and include them as well:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="titanic---studies-on-classification.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">recipe</span>(Survived <span class="sc">~</span> .,<span class="at">data=</span>titanic_train) <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="titanic---studies-on-classification.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(PassengerId,Name,Ticket,Cabin,<span class="at">new_role=</span><span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="titanic---studies-on-classification.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>(),<span class="at">one_hot=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="titanic---studies-on-classification.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>(<span class="at">retain=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="titanic---studies-on-classification.html#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">juice</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-6"><a href="titanic---studies-on-classification.html#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">which</span>(<span class="fu">sapply</span>(.,is.numeric))) <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="titanic---studies-on-classification.html#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">correlate</span>(<span class="at">diagonal =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="titanic---studies-on-classification.html#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rplot</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-9"><a href="titanic---studies-on-classification.html#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">x =</span> <span class="fu">guide_axis</span>(<span class="at">angle=</span><span class="dv">90</span>))</span></code></pre></div>
<pre><code>## 
## Correlation method: &#39;pearson&#39;
## Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type noquote. Defaulting to continuous.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-60-1.png" width="672" />
From the correlation plot we see that Fare and PClass are moderately correlated. This can become an issue later on in the modelling process. We also see that Survived primarily is correlated to Sex and PClass. Lets investigate these further.</p>
<p>First let us have a look at how survived is related to sex:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="titanic---studies-on-classification.html#cb21-1" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="titanic---studies-on-classification.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survived =</span> <span class="fu">as_factor</span>(Survived)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="titanic---studies-on-classification.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survived =</span> <span class="fu">fct_recode</span>(Survived, <span class="st">&quot;Died&quot;</span><span class="ot">=</span><span class="st">&quot;0&quot;</span>,<span class="st">&quot;Survived&quot;</span><span class="ot">=</span><span class="st">&quot;1&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="titanic---studies-on-classification.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Sex, <span class="at">fill=</span>Survived)) <span class="sc">+</span></span>
<span id="cb21-5"><a href="titanic---studies-on-classification.html#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-61-1.png" width="672" />
As expected the two variables are correlated. A higher proportion of women survived compared to men.</p>
<p>Next let us have a look at the Pclass vs Survived:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="titanic---studies-on-classification.html#cb22-1" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="titanic---studies-on-classification.html#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survived =</span> <span class="fu">as_factor</span>(Survived)) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="titanic---studies-on-classification.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Pclass =</span> <span class="fu">as_factor</span>(Pclass)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="titanic---studies-on-classification.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survived =</span> <span class="fu">fct_recode</span>(Survived, <span class="st">&quot;Died&quot;</span><span class="ot">=</span><span class="st">&quot;0&quot;</span>,<span class="st">&quot;Survived&quot;</span><span class="ot">=</span><span class="st">&quot;1&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="titanic---studies-on-classification.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Pclass, <span class="at">fill=</span>Survived)) <span class="sc">+</span></span>
<span id="cb22-6"><a href="titanic---studies-on-classification.html#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-62-1.png" width="672" />
From this we see that a 1st class passenger was more likely to survive than a 3rd class passenger.</p>
<p>Finally we can have a look at the fare distributions of the passengers:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="titanic---studies-on-classification.html#cb23-1" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="titanic---studies-on-classification.html#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survived =</span> <span class="fu">as_factor</span>(Survived)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="titanic---studies-on-classification.html#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survived =</span> <span class="fu">fct_recode</span>(Survived, <span class="st">&quot;Died&quot;</span><span class="ot">=</span><span class="st">&quot;0&quot;</span>,<span class="st">&quot;Survived&quot;</span><span class="ot">=</span><span class="st">&quot;1&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="titanic---studies-on-classification.html#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Fare,<span class="at">color=</span>Survived)) <span class="sc">+</span></span>
<span id="cb23-5"><a href="titanic---studies-on-classification.html#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_density</span>(<span class="at">geom=</span><span class="st">&quot;line&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-63-1.png" width="672" />
We see that among those that died, there is a higher proportion of passengers with a low fare. This is easily explained from the higher proportion of 3rd class passengers among those who died.</p>
</div>
<div id="modelling" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Modelling</h2>
<p>In this section we will develop several models to predict if a passenger will survive or not. Different model classes have different requirements to feature engineering, so we will develop several preprocessing recipes and choose the ones that performs best with respect to accuracy and ROC.</p>
<p>Since some models are able to deal well with NAs we reload the original dataset with missing values for modelling purposes:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="titanic---studies-on-classification.html#cb24-1" aria-hidden="true" tabindex="-1"></a>titanic_train_model <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./titanic_train.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 891 Columns: 12
## ── Column specification ───────────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (5): Name, Sex, Ticket, Cabin, Embarked
## dbl (7): PassengerId, Survived, Pclass, Age, SibSp, Parch, Fare
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>For the classification models we need the outcome to be a factor variable:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="titanic---studies-on-classification.html#cb26-1" aria-hidden="true" tabindex="-1"></a>titanic_train_model <span class="ot">&lt;-</span> titanic_train_model <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Survived =</span> <span class="fu">as_factor</span>(Survived))</span></code></pre></div>
<p>Let us have a look at the skewness of the different numerical variables to decide upon which kind of imputation to choose:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="titanic---studies-on-classification.html#cb27-1" aria-hidden="true" tabindex="-1"></a>titanic_train_model <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="titanic---studies-on-classification.html#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">which</span>(<span class="fu">sapply</span>(.,is.numeric)),<span class="sc">-</span>PassengerId) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="titanic---studies-on-classification.html#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="sc">~</span> moments<span class="sc">::</span><span class="fu">skewness</span>(.))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##   Pclass   Age SibSp Parch  Fare
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 -0.629    NA  3.69  2.74  4.78</code></pre>
<p>We see that all variables are skewed, so we impute them using the median.</p>
<p>All models use the same formula and need to have the same columns as ID columns, so we begin by making a base recipe for the preprocessing:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="titanic---studies-on-classification.html#cb29-1" aria-hidden="true" tabindex="-1"></a>titanic_baserec <span class="ot">&lt;-</span> </span>
<span id="cb29-2"><a href="titanic---studies-on-classification.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(Survived <span class="sc">~</span> ., <span class="at">data=</span>titanic_train_model) <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="titanic---studies-on-classification.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(Ticket,Cabin,Name) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="titanic---studies-on-classification.html#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(PassengerId,<span class="at">new_role=</span><span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<p>To tune the different models we will use 10-fold cross validation. For this purpose we define the folds:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="titanic---studies-on-classification.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb30-2"><a href="titanic---studies-on-classification.html#cb30-2" aria-hidden="true" tabindex="-1"></a>titanic_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(titanic_train_model,<span class="at">strata =</span> Survived)</span></code></pre></div>
<div id="logistic-regression-1" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Logistic Regression</h3>
<p>Logistic regression relies on the features being independent. Moreover it doesn’t do
well with missing values and factors with small frequencies. This gives us the following
recipe for logistic regression:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="titanic---studies-on-classification.html#cb31-1" aria-hidden="true" tabindex="-1"></a>titanic_logit_rec <span class="ot">&lt;-</span> </span>
<span id="cb31-2"><a href="titanic---studies-on-classification.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  titanic_baserec <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="titanic---studies-on-classification.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4"><a href="titanic---studies-on-classification.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb31-5"><a href="titanic---studies-on-classification.html#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb31-6"><a href="titanic---studies-on-classification.html#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span></code></pre></div>
<p>For decorrelation we can choose between PCA and removing correlated variables. Additionally we can decide to normalize the numeric predictors or not. If we do, we use Yeo-Johnson transformation. This gives us the following final recipes for logistic regression:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="titanic---studies-on-classification.html#cb32-1" aria-hidden="true" tabindex="-1"></a>titanic_logit_pca_nonorm <span class="ot">&lt;-</span></span>
<span id="cb32-2"><a href="titanic---studies-on-classification.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  titanic_logit_rec <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="titanic---studies-on-classification.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb32-4"><a href="titanic---studies-on-classification.html#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="titanic---studies-on-classification.html#cb32-5" aria-hidden="true" tabindex="-1"></a>titanic_logit_decor_nonorm <span class="ot">&lt;-</span></span>
<span id="cb32-6"><a href="titanic---studies-on-classification.html#cb32-6" aria-hidden="true" tabindex="-1"></a>  titanic_logit_rec <span class="sc">%&gt;%</span> </span>
<span id="cb32-7"><a href="titanic---studies-on-classification.html#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_corr</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb32-8"><a href="titanic---studies-on-classification.html#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="titanic---studies-on-classification.html#cb32-9" aria-hidden="true" tabindex="-1"></a>titanic_logit_pca_norm <span class="ot">&lt;-</span></span>
<span id="cb32-10"><a href="titanic---studies-on-classification.html#cb32-10" aria-hidden="true" tabindex="-1"></a>  titanic_logit_rec <span class="sc">%&gt;%</span> </span>
<span id="cb32-11"><a href="titanic---studies-on-classification.html#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb32-12"><a href="titanic---studies-on-classification.html#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_YeoJohnson</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="cb32-13"><a href="titanic---studies-on-classification.html#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="titanic---studies-on-classification.html#cb32-14" aria-hidden="true" tabindex="-1"></a>titanic_logit_decor_norm <span class="ot">&lt;-</span></span>
<span id="cb32-15"><a href="titanic---studies-on-classification.html#cb32-15" aria-hidden="true" tabindex="-1"></a>  titanic_logit_rec <span class="sc">%&gt;%</span> </span>
<span id="cb32-16"><a href="titanic---studies-on-classification.html#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_corr</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb32-17"><a href="titanic---studies-on-classification.html#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_YeoJohnson</span>(<span class="fu">all_numeric_predictors</span>())</span></code></pre></div>
<p>For models we can use a regularized or un-regularized logistic regression model. For the regularized model we will using 10-fold cross validation tuning to choose the best regularization parameters.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="titanic---studies-on-classification.html#cb33-1" aria-hidden="true" tabindex="-1"></a>titanic_logit_mod <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="titanic---studies-on-classification.html#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="titanic---studies-on-classification.html#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;glm&quot;</span>)</span>
<span id="cb33-4"><a href="titanic---studies-on-classification.html#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="titanic---studies-on-classification.html#cb33-5" aria-hidden="true" tabindex="-1"></a>titanic_reg_logit_mod <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>(<span class="at">penalty=</span><span class="fu">tune</span>(),<span class="at">mixture=</span><span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb33-6"><a href="titanic---studies-on-classification.html#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-7"><a href="titanic---studies-on-classification.html#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>)</span></code></pre></div>
<p>Now we can define the workflow set for the different models and recipes:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="titanic---studies-on-classification.html#cb34-1" aria-hidden="true" tabindex="-1"></a>titanic_logit_wfs <span class="ot">&lt;-</span> </span>
<span id="cb34-2"><a href="titanic---studies-on-classification.html#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_set</span>(</span>
<span id="cb34-3"><a href="titanic---studies-on-classification.html#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">DeCorNoNorm =</span> titanic_logit_decor_nonorm, </span>
<span id="cb34-4"><a href="titanic---studies-on-classification.html#cb34-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">DeCorNorm =</span> titanic_logit_decor_norm,</span>
<span id="cb34-5"><a href="titanic---studies-on-classification.html#cb34-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">PCANoNorm =</span> titanic_logit_pca_nonorm,</span>
<span id="cb34-6"><a href="titanic---studies-on-classification.html#cb34-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">PCANorm =</span> titanic_logit_pca_norm),</span>
<span id="cb34-7"><a href="titanic---studies-on-classification.html#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">models =</span> <span class="fu">list</span>(<span class="at">regularized =</span> titanic_reg_logit_mod,</span>
<span id="cb34-8"><a href="titanic---studies-on-classification.html#cb34-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">unregularized =</span>titanic_logit_mod)</span>
<span id="cb34-9"><a href="titanic---studies-on-classification.html#cb34-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>For tuning the regularized model we define the following tuning grid:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="titanic---studies-on-classification.html#cb35-1" aria-hidden="true" tabindex="-1"></a>titanic_logit_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">penalty</span>(),<span class="fu">mixture</span>(),<span class="at">levels=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">2</span>)) </span></code></pre></div>
<p>We are now ready to fit at tune the various models:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="titanic---studies-on-classification.html#cb36-1" aria-hidden="true" tabindex="-1"></a>titanic_logit_control <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(</span>
<span id="cb36-2"><a href="titanic---studies-on-classification.html#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_pred =</span> <span class="cn">TRUE</span>,</span>
<span id="cb36-3"><a href="titanic---studies-on-classification.html#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_over =</span> <span class="st">&quot;everything&quot;</span>,</span>
<span id="cb36-4"><a href="titanic---studies-on-classification.html#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_workflow =</span> <span class="cn">TRUE</span></span>
<span id="cb36-5"><a href="titanic---studies-on-classification.html#cb36-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-6"><a href="titanic---studies-on-classification.html#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="titanic---studies-on-classification.html#cb36-7" aria-hidden="true" tabindex="-1"></a>titanic_logit_results <span class="ot">&lt;-</span> </span>
<span id="cb36-8"><a href="titanic---studies-on-classification.html#cb36-8" aria-hidden="true" tabindex="-1"></a>  titanic_logit_wfs <span class="sc">%&gt;%</span> </span>
<span id="cb36-9"><a href="titanic---studies-on-classification.html#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_map</span>(</span>
<span id="cb36-10"><a href="titanic---studies-on-classification.html#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb36-11"><a href="titanic---studies-on-classification.html#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> titanic_folds,</span>
<span id="cb36-12"><a href="titanic---studies-on-classification.html#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> titanic_logit_grid,</span>
<span id="cb36-13"><a href="titanic---studies-on-classification.html#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> titanic_logit_control, </span>
<span id="cb36-14"><a href="titanic---studies-on-classification.html#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy,roc_auc),</span>
<span id="cb36-15"><a href="titanic---studies-on-classification.html#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb36-16"><a href="titanic---studies-on-classification.html#cb36-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## i 1 of 8 tuning:     DeCorNoNorm_regularized</code></pre>
<pre><code>## ✓ 1 of 8 tuning:     DeCorNoNorm_regularized (23.6s)</code></pre>
<pre><code>## i    No tuning parameters. `fit_resamples()` will be attempted</code></pre>
<pre><code>## i 2 of 8 resampling: DeCorNoNorm_unregularized</code></pre>
<pre><code>## ✓ 2 of 8 resampling: DeCorNoNorm_unregularized (8.1s)</code></pre>
<pre><code>## i 3 of 8 tuning:     DeCorNorm_regularized</code></pre>
<pre><code>## ✓ 3 of 8 tuning:     DeCorNorm_regularized (24.7s)</code></pre>
<pre><code>## i    No tuning parameters. `fit_resamples()` will be attempted</code></pre>
<pre><code>## i 4 of 8 resampling: DeCorNorm_unregularized</code></pre>
<pre><code>## ✓ 4 of 8 resampling: DeCorNorm_unregularized (8.9s)</code></pre>
<pre><code>## i 5 of 8 tuning:     PCANoNorm_regularized</code></pre>
<pre><code>## ✓ 5 of 8 tuning:     PCANoNorm_regularized (23.4s)</code></pre>
<pre><code>## i    No tuning parameters. `fit_resamples()` will be attempted</code></pre>
<pre><code>## i 6 of 8 resampling: PCANoNorm_unregularized</code></pre>
<pre><code>## ✓ 6 of 8 resampling: PCANoNorm_unregularized (8s)</code></pre>
<pre><code>## i 7 of 8 tuning:     PCANorm_regularized</code></pre>
<pre><code>## ✓ 7 of 8 tuning:     PCANorm_regularized (24.6s)</code></pre>
<pre><code>## i    No tuning parameters. `fit_resamples()` will be attempted</code></pre>
<pre><code>## i 8 of 8 resampling: PCANorm_unregularized</code></pre>
<pre><code>## ✓ 8 of 8 resampling: PCANorm_unregularized (8.6s)</code></pre>
<p>Let us have a plot of the fitted models and workflows:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="titanic---studies-on-classification.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(titanic_logit_results,<span class="at">rank_metric=</span><span class="st">&quot;accuracy&quot;</span>,<span class="at">select_best =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb57-2"><a href="titanic---studies-on-classification.html#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="fl">0.45</span>,<span class="at">label=</span> wflow_id), <span class="at">angle=</span><span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb57-3"><a href="titanic---studies-on-classification.html#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb57-4"><a href="titanic---studies-on-classification.html#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-75-1.png" width="672" />
We see that using PCA to decorrelate features is performing worse than simple removal of correlated variables. Moreover normalizing doens’t seem to increase performance and accuracy and ROC agree well when determining best model and workflow.</p>
<p>Let us find the best tuning parameters:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="titanic---studies-on-classification.html#cb58-1" aria-hidden="true" tabindex="-1"></a>titanic_logit_best_parm <span class="ot">&lt;-</span></span>
<span id="cb58-2"><a href="titanic---studies-on-classification.html#cb58-2" aria-hidden="true" tabindex="-1"></a>   titanic_logit_results <span class="sc">%&gt;%</span> </span>
<span id="cb58-3"><a href="titanic---studies-on-classification.html#cb58-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">extract_workflow_set_result</span>(<span class="st">&quot;DeCorNoNorm_regularized&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb58-4"><a href="titanic---studies-on-classification.html#cb58-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select_best</span>(<span class="at">metric=</span><span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb58-5"><a href="titanic---studies-on-classification.html#cb58-5" aria-hidden="true" tabindex="-1"></a>titanic_logit_best_parm</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##        penalty mixture .config              
##          &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1 0.0000000001       0 Preprocessor1_Model01</code></pre>
<p>So the best option is Lasso regression with a slight penalty of 1.0e-10.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="titanic---studies-on-classification.html#cb60-1" aria-hidden="true" tabindex="-1"></a>titanic_logit_best_wf <span class="ot">&lt;-</span> titanic_logit_results <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="titanic---studies-on-classification.html#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_workflow</span>(<span class="st">&quot;DeCorNoNorm_regularized&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="titanic---studies-on-classification.html#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(titanic_logit_best_parm)</span>
<span id="cb60-4"><a href="titanic---studies-on-classification.html#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="titanic---studies-on-classification.html#cb60-5" aria-hidden="true" tabindex="-1"></a>titanic_logit_best_mod <span class="ot">&lt;-</span> <span class="fu">fit</span>(titanic_logit_best_wf,titanic_train_model)</span>
<span id="cb60-6"><a href="titanic---studies-on-classification.html#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="titanic---studies-on-classification.html#cb60-7" aria-hidden="true" tabindex="-1"></a>titanic_logit_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(titanic_logit_best_mod,<span class="at">new_data=</span>titanic_test)</span></code></pre></div>
<p>We are now ready to write the predictions to a file and upload to Kaggle:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="titanic---studies-on-classification.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">PassengerId =</span> titanic_test<span class="sc">$</span>PassengerId,titanic_logit_pred) <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="titanic---studies-on-classification.html#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Survived =</span> .pred_class) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="titanic---studies-on-classification.html#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;./titanic_logit_pred.csv&quot;</span>)</span></code></pre></div>
<p>The Kaggle score (which established the baseline for this chapter), is 0.76315. The accuracy is as expected slightly lower than for the training data, but a very respectable result for a linear model.</p>
<p>Lets us collect the results in a Tibble, which we can use at the end of the chapter:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="titanic---studies-on-classification.html#cb62-1" aria-hidden="true" tabindex="-1"></a>results_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Model =</span> <span class="fu">c</span>(<span class="st">&quot;L2-penalized Logistic Regression&quot;</span>), <span class="at">Score =</span> <span class="st">&quot;0.76315&quot;</span>)</span>
<span id="cb62-2"><a href="titanic---studies-on-classification.html#cb62-2" aria-hidden="true" tabindex="-1"></a>results_table <span class="sc">%&gt;%</span> <span class="fu">kbl</span>() <span class="sc">%&gt;%</span> <span class="fu">kable_material</span>(<span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>,<span class="st">&quot;hover&quot;</span>))</span></code></pre></div>
<table class=" lightable-material lightable-striped lightable-hover" style="font-family: &quot;Source Sans Pro&quot;, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Model
</th>
<th style="text-align:left;">
Score
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
L2-penalized Logistic Regression
</td>
<td style="text-align:left;">
0.76315
</td>
</tr>
</tbody>
</table>
</div>
<div id="lda" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> LDA</h3>
<p>The linear discriminant classifier (LDA-C) is mostly included for reference. In general it is not expected to perform as well as the penalized logistic regression.</p>
<p>Pre-processing for the LDA is almost the same as for logistic regression. We need to remove zero variance variables as well as ID variables. Moreover we need to one-hot
encode factors and and de-corrolate features. Finally LDA might benefit from normalization of variables, in which case we use Yeo Johnson transformation.</p>
<p>This leaves us with the following preprocessing recipes:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="titanic---studies-on-classification.html#cb63-1" aria-hidden="true" tabindex="-1"></a>titanic_lda_nonorm_rec <span class="ot">&lt;-</span> </span>
<span id="cb63-2"><a href="titanic---studies-on-classification.html#cb63-2" aria-hidden="true" tabindex="-1"></a>  titanic_baserec <span class="sc">%&gt;%</span> </span>
<span id="cb63-3"><a href="titanic---studies-on-classification.html#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-4"><a href="titanic---studies-on-classification.html#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-5"><a href="titanic---studies-on-classification.html#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-6"><a href="titanic---studies-on-classification.html#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb63-7"><a href="titanic---studies-on-classification.html#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="titanic---studies-on-classification.html#cb63-8" aria-hidden="true" tabindex="-1"></a>titanic_lda_norm_rec <span class="ot">&lt;-</span> </span>
<span id="cb63-9"><a href="titanic---studies-on-classification.html#cb63-9" aria-hidden="true" tabindex="-1"></a>  titanic_baserec <span class="sc">%&gt;%</span> </span>
<span id="cb63-10"><a href="titanic---studies-on-classification.html#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-11"><a href="titanic---studies-on-classification.html#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-12"><a href="titanic---studies-on-classification.html#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-13"><a href="titanic---studies-on-classification.html#cb63-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-14"><a href="titanic---studies-on-classification.html#cb63-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_YeoJohnson</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="cb63-15"><a href="titanic---studies-on-classification.html#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="titanic---studies-on-classification.html#cb63-16" aria-hidden="true" tabindex="-1"></a>titanic_lda_decor_nonorm_rec <span class="ot">&lt;-</span> </span>
<span id="cb63-17"><a href="titanic---studies-on-classification.html#cb63-17" aria-hidden="true" tabindex="-1"></a>  titanic_baserec <span class="sc">%&gt;%</span> </span>
<span id="cb63-18"><a href="titanic---studies-on-classification.html#cb63-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-19"><a href="titanic---studies-on-classification.html#cb63-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-20"><a href="titanic---studies-on-classification.html#cb63-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-21"><a href="titanic---studies-on-classification.html#cb63-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-22"><a href="titanic---studies-on-classification.html#cb63-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_corr</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb63-23"><a href="titanic---studies-on-classification.html#cb63-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-24"><a href="titanic---studies-on-classification.html#cb63-24" aria-hidden="true" tabindex="-1"></a>titanic_lda_decor_norm_rec <span class="ot">&lt;-</span> </span>
<span id="cb63-25"><a href="titanic---studies-on-classification.html#cb63-25" aria-hidden="true" tabindex="-1"></a>  titanic_baserec <span class="sc">%&gt;%</span> </span>
<span id="cb63-26"><a href="titanic---studies-on-classification.html#cb63-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-27"><a href="titanic---studies-on-classification.html#cb63-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-28"><a href="titanic---studies-on-classification.html#cb63-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-29"><a href="titanic---studies-on-classification.html#cb63-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-30"><a href="titanic---studies-on-classification.html#cb63-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_YeoJohnson</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-31"><a href="titanic---studies-on-classification.html#cb63-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_corr</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb63-32"><a href="titanic---studies-on-classification.html#cb63-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-33"><a href="titanic---studies-on-classification.html#cb63-33" aria-hidden="true" tabindex="-1"></a>titanic_lda_pca_nonorm_rec <span class="ot">&lt;-</span> </span>
<span id="cb63-34"><a href="titanic---studies-on-classification.html#cb63-34" aria-hidden="true" tabindex="-1"></a>  titanic_baserec <span class="sc">%&gt;%</span> </span>
<span id="cb63-35"><a href="titanic---studies-on-classification.html#cb63-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-36"><a href="titanic---studies-on-classification.html#cb63-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-37"><a href="titanic---studies-on-classification.html#cb63-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-38"><a href="titanic---studies-on-classification.html#cb63-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-39"><a href="titanic---studies-on-classification.html#cb63-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb63-40"><a href="titanic---studies-on-classification.html#cb63-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-41"><a href="titanic---studies-on-classification.html#cb63-41" aria-hidden="true" tabindex="-1"></a>titanic_lda_pca_norm_rec <span class="ot">&lt;-</span> </span>
<span id="cb63-42"><a href="titanic---studies-on-classification.html#cb63-42" aria-hidden="true" tabindex="-1"></a>  titanic_baserec <span class="sc">%&gt;%</span> </span>
<span id="cb63-43"><a href="titanic---studies-on-classification.html#cb63-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-44"><a href="titanic---studies-on-classification.html#cb63-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-45"><a href="titanic---studies-on-classification.html#cb63-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-46"><a href="titanic---studies-on-classification.html#cb63-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-47"><a href="titanic---studies-on-classification.html#cb63-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_YeoJohnson</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb63-48"><a href="titanic---studies-on-classification.html#cb63-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(<span class="fu">all_predictors</span>())</span></code></pre></div>
<p>This section is temporarily aborted due to problems with {Discrim} package.</p>
</div>
<div id="knn" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> kNN</h3>
<p>With no included preprocessing measures in the algorithm, the kNN model relies on heavy preprocessing steps including one hot encoding of dummy variables, removing zero variance variables, imputing NAs and normalizing variables. Decorrelation might improve importance. This gives us three different workflows:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="titanic---studies-on-classification.html#cb64-1" aria-hidden="true" tabindex="-1"></a>titanic_knn_rec <span class="ot">&lt;-</span> </span>
<span id="cb64-2"><a href="titanic---studies-on-classification.html#cb64-2" aria-hidden="true" tabindex="-1"></a>  titanic_baserec <span class="sc">%&gt;%</span> </span>
<span id="cb64-3"><a href="titanic---studies-on-classification.html#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb64-4"><a href="titanic---studies-on-classification.html#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb64-5"><a href="titanic---studies-on-classification.html#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb64-6"><a href="titanic---studies-on-classification.html#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb64-7"><a href="titanic---studies-on-classification.html#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_YeoJohnson</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="cb64-8"><a href="titanic---studies-on-classification.html#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="titanic---studies-on-classification.html#cb64-9" aria-hidden="true" tabindex="-1"></a>titanic_knn_decor_rec <span class="ot">&lt;-</span> </span>
<span id="cb64-10"><a href="titanic---studies-on-classification.html#cb64-10" aria-hidden="true" tabindex="-1"></a>  titanic_knn_rec <span class="sc">%&gt;%</span> </span>
<span id="cb64-11"><a href="titanic---studies-on-classification.html#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_corr</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb64-12"><a href="titanic---studies-on-classification.html#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="titanic---studies-on-classification.html#cb64-13" aria-hidden="true" tabindex="-1"></a>titanic_knn_pca_rec <span class="ot">&lt;-</span></span>
<span id="cb64-14"><a href="titanic---studies-on-classification.html#cb64-14" aria-hidden="true" tabindex="-1"></a>  titanic_knn_rec <span class="sc">%&gt;%</span> </span>
<span id="cb64-15"><a href="titanic---studies-on-classification.html#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(<span class="fu">all_predictors</span>())</span></code></pre></div>
<p>We can now define the kNN model</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="titanic---studies-on-classification.html#cb65-1" aria-hidden="true" tabindex="-1"></a>titanic_knn_mod <span class="ot">&lt;-</span> <span class="fu">nearest_neighbor</span>(<span class="at">neighbors=</span> <span class="fu">tune</span>(), <span class="at">weight_func=</span><span class="fu">tune</span>(), <span class="at">dist_power =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="titanic---studies-on-classification.html#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb65-3"><a href="titanic---studies-on-classification.html#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;kknn&quot;</span>)</span></code></pre></div>
<p>Next we set up the grid for the grid search. We will try 10 levels of n, 9 different weight functions and 4 different distance metrics:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="titanic---studies-on-classification.html#cb66-1" aria-hidden="true" tabindex="-1"></a>titanic_knn_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">neighbors</span>(),<span class="fu">weight_func</span>(),<span class="fu">dist_power</span>(),<span class="at">levels=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">9</span>,<span class="dv">4</span>))</span></code></pre></div>
<p>Now we can define the workflow set for the different models and recipes:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="titanic---studies-on-classification.html#cb67-1" aria-hidden="true" tabindex="-1"></a>titanic_knn_wfs <span class="ot">&lt;-</span> </span>
<span id="cb67-2"><a href="titanic---studies-on-classification.html#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_set</span>(</span>
<span id="cb67-3"><a href="titanic---studies-on-classification.html#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">NoDecor =</span> titanic_knn_rec, </span>
<span id="cb67-4"><a href="titanic---studies-on-classification.html#cb67-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Decor =</span> titanic_knn_decor_rec,</span>
<span id="cb67-5"><a href="titanic---studies-on-classification.html#cb67-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">PCA =</span> titanic_knn_pca_rec),</span>
<span id="cb67-6"><a href="titanic---studies-on-classification.html#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">models =</span> <span class="fu">list</span>(<span class="at">kNN =</span> titanic_knn_mod)</span>
<span id="cb67-7"><a href="titanic---studies-on-classification.html#cb67-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>We are now ready to fit and tune the various models:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="titanic---studies-on-classification.html#cb68-1" aria-hidden="true" tabindex="-1"></a>titanic_knn_control <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(</span>
<span id="cb68-2"><a href="titanic---studies-on-classification.html#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_pred =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-3"><a href="titanic---studies-on-classification.html#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_over =</span> <span class="st">&quot;everything&quot;</span>,</span>
<span id="cb68-4"><a href="titanic---studies-on-classification.html#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_workflow =</span> <span class="cn">TRUE</span></span>
<span id="cb68-5"><a href="titanic---studies-on-classification.html#cb68-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-6"><a href="titanic---studies-on-classification.html#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="titanic---studies-on-classification.html#cb68-7" aria-hidden="true" tabindex="-1"></a>titanic_knn_results <span class="ot">&lt;-</span> </span>
<span id="cb68-8"><a href="titanic---studies-on-classification.html#cb68-8" aria-hidden="true" tabindex="-1"></a>  titanic_knn_wfs <span class="sc">%&gt;%</span> </span>
<span id="cb68-9"><a href="titanic---studies-on-classification.html#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_map</span>(</span>
<span id="cb68-10"><a href="titanic---studies-on-classification.html#cb68-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb68-11"><a href="titanic---studies-on-classification.html#cb68-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> titanic_folds,</span>
<span id="cb68-12"><a href="titanic---studies-on-classification.html#cb68-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> titanic_knn_grid,</span>
<span id="cb68-13"><a href="titanic---studies-on-classification.html#cb68-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> titanic_knn_control, </span>
<span id="cb68-14"><a href="titanic---studies-on-classification.html#cb68-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy,roc_auc),</span>
<span id="cb68-15"><a href="titanic---studies-on-classification.html#cb68-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb68-16"><a href="titanic---studies-on-classification.html#cb68-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## i 1 of 3 tuning:     NoDecor_kNN</code></pre>
<pre><code>## ✓ 1 of 3 tuning:     NoDecor_kNN (13m 12.2s)</code></pre>
<pre><code>## i 2 of 3 tuning:     Decor_kNN</code></pre>
<pre><code>## ✓ 2 of 3 tuning:     Decor_kNN (13m 22.6s)</code></pre>
<pre><code>## i 3 of 3 tuning:     PCA_kNN</code></pre>
<pre><code>## ✓ 3 of 3 tuning:     PCA_kNN (13m 13.7s)</code></pre>
<p>Let us have a plot of the fitted models and workflows:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="titanic---studies-on-classification.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(titanic_knn_results,<span class="at">rank_metric=</span><span class="st">&quot;accuracy&quot;</span>,<span class="at">select_best =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb75-2"><a href="titanic---studies-on-classification.html#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="fl">0.45</span>,<span class="at">label=</span> wflow_id), <span class="at">angle=</span><span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb75-3"><a href="titanic---studies-on-classification.html#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb75-4"><a href="titanic---studies-on-classification.html#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-85-1.png" width="672" />
We see that using PCA to decorrelate features is performing slightly worse than simple removal of correlated variables.</p>
<p>Let us find the best tuning parameters with respect to accuray:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="titanic---studies-on-classification.html#cb76-1" aria-hidden="true" tabindex="-1"></a>titanic_knn_best_parm <span class="ot">&lt;-</span></span>
<span id="cb76-2"><a href="titanic---studies-on-classification.html#cb76-2" aria-hidden="true" tabindex="-1"></a>   titanic_knn_results <span class="sc">%&gt;%</span> </span>
<span id="cb76-3"><a href="titanic---studies-on-classification.html#cb76-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">extract_workflow_set_result</span>(<span class="st">&quot;NoDecor_kNN&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-4"><a href="titanic---studies-on-classification.html#cb76-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select_best</span>(<span class="at">metric=</span><span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb76-5"><a href="titanic---studies-on-classification.html#cb76-5" aria-hidden="true" tabindex="-1"></a>titanic_knn_best_parm</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##   neighbors weight_func dist_power .config               
##       &lt;int&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;                 
## 1         6 rank                 2 Preprocessor1_Model236</code></pre>
<p>So the best option is kNN with n=6, rank weight function and L2-distance.</p>
<p>We can now define best workflow and fit to the training data</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="titanic---studies-on-classification.html#cb78-1" aria-hidden="true" tabindex="-1"></a>titanic_knn_best_wf <span class="ot">&lt;-</span> titanic_knn_results <span class="sc">%&gt;%</span> </span>
<span id="cb78-2"><a href="titanic---studies-on-classification.html#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_workflow</span>(<span class="st">&quot;NoDecor_kNN&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb78-3"><a href="titanic---studies-on-classification.html#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(titanic_knn_best_parm)</span>
<span id="cb78-4"><a href="titanic---studies-on-classification.html#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="titanic---studies-on-classification.html#cb78-5" aria-hidden="true" tabindex="-1"></a>titanic_knn_best_mod <span class="ot">&lt;-</span> <span class="fu">fit</span>(titanic_knn_best_wf,titanic_train_model)</span>
<span id="cb78-6"><a href="titanic---studies-on-classification.html#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="titanic---studies-on-classification.html#cb78-7" aria-hidden="true" tabindex="-1"></a>titanic_knn_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(titanic_knn_best_mod,<span class="at">new_data=</span>titanic_test)</span></code></pre></div>
<p>We are now ready to write the predictions to a file and upload to Kaggle:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="titanic---studies-on-classification.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">PassengerId =</span> titanic_test<span class="sc">$</span>PassengerId,titanic_knn_pred) <span class="sc">%&gt;%</span> </span>
<span id="cb79-2"><a href="titanic---studies-on-classification.html#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Survived =</span> .pred_class) <span class="sc">%&gt;%</span> </span>
<span id="cb79-3"><a href="titanic---studies-on-classification.html#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;./titanic_knn_pred.csv&quot;</span>)</span></code></pre></div>
<p>The Kaggle score, is 0.76315. The accuracy is exactly as for the logistic regression model.</p>
<p>Lets us collect the results in a Tibble, which we can use at the end of the chapter:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="titanic---studies-on-classification.html#cb80-1" aria-hidden="true" tabindex="-1"></a>results_table <span class="ot">&lt;-</span> results_table <span class="sc">%&gt;%</span> <span class="fu">add_row</span>(<span class="at">Model =</span> <span class="st">&quot;6 Nearest Neighbors, Rank weight, L2 distance&quot;</span>, <span class="at">Score=</span><span class="st">&quot;0.76315&quot;</span>)</span>
<span id="cb80-2"><a href="titanic---studies-on-classification.html#cb80-2" aria-hidden="true" tabindex="-1"></a>results_table <span class="sc">%&gt;%</span> <span class="fu">kbl</span>() <span class="sc">%&gt;%</span> <span class="fu">kable_material</span>(<span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>,<span class="st">&quot;hover&quot;</span>))</span></code></pre></div>
<table class=" lightable-material lightable-striped lightable-hover" style="font-family: &quot;Source Sans Pro&quot;, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Model
</th>
<th style="text-align:left;">
Score
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
L2-penalized Logistic Regression
</td>
<td style="text-align:left;">
0.76315
</td>
</tr>
<tr>
<td style="text-align:left;">
6 Nearest Neighbors, Rank weight, L2 distance
</td>
<td style="text-align:left;">
0.76315
</td>
</tr>
</tbody>
</table>
</div>
<div id="svm" class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> SVM</h3>
<p>The Support Vector Machine relies heavily on preprocessing of data. There are no built in room in the algorithm for dirty data. From the two previous sections it seems that PCA is less favourable for these data, so we will rely on simple decorrolation in this section. For normalizing we will use the BestNormalizer on the data. This leaves us with the following preprocessing recipe:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="titanic---studies-on-classification.html#cb81-1" aria-hidden="true" tabindex="-1"></a>titanic_svm_rec <span class="ot">&lt;-</span> </span>
<span id="cb81-2"><a href="titanic---studies-on-classification.html#cb81-2" aria-hidden="true" tabindex="-1"></a>  titanic_baserec <span class="sc">%&gt;%</span> </span>
<span id="cb81-3"><a href="titanic---studies-on-classification.html#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb81-4"><a href="titanic---studies-on-classification.html#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb81-5"><a href="titanic---studies-on-classification.html#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb81-6"><a href="titanic---studies-on-classification.html#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb81-7"><a href="titanic---studies-on-classification.html#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_YeoJohnson</span>(<span class="fu">all_predictors</span>())</span></code></pre></div>
<p>In tidymodels the SVM kernel is defined from the model. We will define three models using respectively Linear, Polynomial and Radial Basis Function kernels.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="titanic---studies-on-classification.html#cb82-1" aria-hidden="true" tabindex="-1"></a>titanic_svm_lin <span class="ot">&lt;-</span> <span class="fu">svm_linear</span>(<span class="at">cost=</span><span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="titanic---studies-on-classification.html#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-3"><a href="titanic---studies-on-classification.html#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;kernlab&quot;</span>, <span class="at">scaled=</span><span class="cn">TRUE</span>)</span>
<span id="cb82-4"><a href="titanic---studies-on-classification.html#cb82-4" aria-hidden="true" tabindex="-1"></a>titanic_svm_pol <span class="ot">&lt;-</span> <span class="fu">svm_poly</span>(<span class="at">cost=</span><span class="fu">tune</span>(),<span class="at">degree=</span><span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb82-5"><a href="titanic---studies-on-classification.html#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-6"><a href="titanic---studies-on-classification.html#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;kernlab&quot;</span>, <span class="at">scaled=</span><span class="cn">TRUE</span>)</span>
<span id="cb82-7"><a href="titanic---studies-on-classification.html#cb82-7" aria-hidden="true" tabindex="-1"></a>titanic_svm_radial <span class="ot">&lt;-</span> <span class="fu">svm_rbf</span>(<span class="at">cost=</span><span class="fu">tune</span>(),<span class="at">rbf_sigma=</span><span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb82-8"><a href="titanic---studies-on-classification.html#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-9"><a href="titanic---studies-on-classification.html#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;kernlab&quot;</span>, <span class="at">scaled=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>Now we can define the workflow set for the different models and recipes:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="titanic---studies-on-classification.html#cb83-1" aria-hidden="true" tabindex="-1"></a>titanic_svm_wfs <span class="ot">&lt;-</span> </span>
<span id="cb83-2"><a href="titanic---studies-on-classification.html#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_set</span>(</span>
<span id="cb83-3"><a href="titanic---studies-on-classification.html#cb83-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">rec =</span> titanic_svm_rec),</span>
<span id="cb83-4"><a href="titanic---studies-on-classification.html#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">models =</span> <span class="fu">list</span>(<span class="at">Lin =</span> titanic_svm_lin,</span>
<span id="cb83-5"><a href="titanic---studies-on-classification.html#cb83-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Poly =</span> titanic_svm_pol,</span>
<span id="cb83-6"><a href="titanic---studies-on-classification.html#cb83-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">RBF =</span> titanic_svm_radial)</span>
<span id="cb83-7"><a href="titanic---studies-on-classification.html#cb83-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>With different number of tuning parameters in the three models, we will rely on tidymodels to choose and apropriate grid of size 25 for the parameters.</p>
<p>We are now ready to fit at tune the various models:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="titanic---studies-on-classification.html#cb84-1" aria-hidden="true" tabindex="-1"></a>titanic_svm_control <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(</span>
<span id="cb84-2"><a href="titanic---studies-on-classification.html#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_pred =</span> <span class="cn">TRUE</span>,</span>
<span id="cb84-3"><a href="titanic---studies-on-classification.html#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_over =</span> <span class="st">&quot;everything&quot;</span>,</span>
<span id="cb84-4"><a href="titanic---studies-on-classification.html#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_workflow =</span> <span class="cn">TRUE</span></span>
<span id="cb84-5"><a href="titanic---studies-on-classification.html#cb84-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-6"><a href="titanic---studies-on-classification.html#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="titanic---studies-on-classification.html#cb84-7" aria-hidden="true" tabindex="-1"></a>titanic_svm_results <span class="ot">&lt;-</span> </span>
<span id="cb84-8"><a href="titanic---studies-on-classification.html#cb84-8" aria-hidden="true" tabindex="-1"></a>  titanic_svm_wfs <span class="sc">%&gt;%</span> </span>
<span id="cb84-9"><a href="titanic---studies-on-classification.html#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_map</span>(</span>
<span id="cb84-10"><a href="titanic---studies-on-classification.html#cb84-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb84-11"><a href="titanic---studies-on-classification.html#cb84-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> titanic_folds,</span>
<span id="cb84-12"><a href="titanic---studies-on-classification.html#cb84-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> <span class="dv">25</span>,</span>
<span id="cb84-13"><a href="titanic---studies-on-classification.html#cb84-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> titanic_svm_control, </span>
<span id="cb84-14"><a href="titanic---studies-on-classification.html#cb84-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy,roc_auc),</span>
<span id="cb84-15"><a href="titanic---studies-on-classification.html#cb84-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb84-16"><a href="titanic---studies-on-classification.html#cb84-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## i 1 of 3 tuning:     rec_Lin</code></pre>
<pre><code>## ✓ 1 of 3 tuning:     rec_Lin (3m 53.2s)</code></pre>
<pre><code>## i 2 of 3 tuning:     rec_Poly</code></pre>
<pre><code>## ✓ 2 of 3 tuning:     rec_Poly (13m 27.1s)</code></pre>
<pre><code>## i 3 of 3 tuning:     rec_RBF</code></pre>
<pre><code>## ✓ 3 of 3 tuning:     rec_RBF (4m 10.9s)</code></pre>
<p>Let us have a look at the results:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="titanic---studies-on-classification.html#cb91-1" aria-hidden="true" tabindex="-1"></a>titanic_svm_results <span class="sc">%&gt;%</span> </span>
<span id="cb91-2"><a href="titanic---studies-on-classification.html#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rank_results</span>(<span class="at">select_best=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb91-3"><a href="titanic---studies-on-classification.html#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&quot;accuracy&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 9
##   wflow_id .config               .metric   mean std_err     n preprocessor model       rank
##   &lt;chr&gt;    &lt;chr&gt;                 &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;int&gt;
## 1 rec_Poly Preprocessor1_Model01 accuracy 0.824  0.0118    10 recipe       svm_poly       1
## 2 rec_RBF  Preprocessor1_Model17 accuracy 0.815  0.0119    10 recipe       svm_rbf        2
## 3 rec_Lin  Preprocessor1_Model01 accuracy 0.787  0.0142    10 recipe       svm_linear     3</code></pre>
<p>We see that the best performing model uses a Polynomial kernel.</p>
<p>Let us find the best tuning parameters with respect to accuracy:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="titanic---studies-on-classification.html#cb93-1" aria-hidden="true" tabindex="-1"></a>titanic_svm_best_parm <span class="ot">&lt;-</span></span>
<span id="cb93-2"><a href="titanic---studies-on-classification.html#cb93-2" aria-hidden="true" tabindex="-1"></a>   titanic_svm_results <span class="sc">%&gt;%</span> </span>
<span id="cb93-3"><a href="titanic---studies-on-classification.html#cb93-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">extract_workflow_set_result</span>(<span class="st">&quot;rec_Poly&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-4"><a href="titanic---studies-on-classification.html#cb93-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select_best</span>(<span class="at">metric=</span><span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb93-5"><a href="titanic---studies-on-classification.html#cb93-5" aria-hidden="true" tabindex="-1"></a>titanic_svm_best_parm</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##      cost degree .config              
##     &lt;dbl&gt;  &lt;int&gt; &lt;chr&gt;                
## 1 0.00369      2 Preprocessor1_Model01</code></pre>
<p>So the best option is SVM with 2nd degree Polynomial kernel with cost parameter 3.69e-3.</p>
<p>We can now define best workflow and fit to the training data</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="titanic---studies-on-classification.html#cb95-1" aria-hidden="true" tabindex="-1"></a>titanic_svm_best_wf <span class="ot">&lt;-</span> titanic_svm_results <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="titanic---studies-on-classification.html#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_workflow</span>(<span class="st">&quot;rec_Poly&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-3"><a href="titanic---studies-on-classification.html#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(titanic_svm_best_parm)</span>
<span id="cb95-4"><a href="titanic---studies-on-classification.html#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="titanic---studies-on-classification.html#cb95-5" aria-hidden="true" tabindex="-1"></a>titanic_svm_best_mod <span class="ot">&lt;-</span> <span class="fu">fit</span>(titanic_svm_best_wf,titanic_train_model)</span>
<span id="cb95-6"><a href="titanic---studies-on-classification.html#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="titanic---studies-on-classification.html#cb95-7" aria-hidden="true" tabindex="-1"></a>titanic_svm_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(titanic_svm_best_mod,<span class="at">new_data=</span>titanic_test)</span></code></pre></div>
<p>We are now ready to write the predictions to a file and upload to Kaggle:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="titanic---studies-on-classification.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">PassengerId =</span> titanic_test<span class="sc">$</span>PassengerId,titanic_svm_pred) <span class="sc">%&gt;%</span> </span>
<span id="cb96-2"><a href="titanic---studies-on-classification.html#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Survived =</span> .pred_class) <span class="sc">%&gt;%</span> </span>
<span id="cb96-3"><a href="titanic---studies-on-classification.html#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;./titanic_svm_pred.csv&quot;</span>)</span></code></pre></div>
<p>The Kaggle score is 0.77272, which is a slight improvement over the previous models, but still inferior when it comes to Kaggle.</p>
<p>Lets us add the results to our table</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="titanic---studies-on-classification.html#cb97-1" aria-hidden="true" tabindex="-1"></a>results_table <span class="ot">&lt;-</span> results_table <span class="sc">%&gt;%</span> <span class="fu">add_row</span>(<span class="at">Model =</span> <span class="st">&quot;Support Vector Machine with 2nd degree polynomial kernel&quot;</span>, <span class="at">Score=</span><span class="st">&quot;0.77272&quot;</span>)</span>
<span id="cb97-2"><a href="titanic---studies-on-classification.html#cb97-2" aria-hidden="true" tabindex="-1"></a>results_table <span class="sc">%&gt;%</span> <span class="fu">kbl</span>() <span class="sc">%&gt;%</span> <span class="fu">kable_material</span>(<span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>,<span class="st">&quot;hover&quot;</span>))</span></code></pre></div>
<table class=" lightable-material lightable-striped lightable-hover" style="font-family: &quot;Source Sans Pro&quot;, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Model
</th>
<th style="text-align:left;">
Score
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
L2-penalized Logistic Regression
</td>
<td style="text-align:left;">
0.76315
</td>
</tr>
<tr>
<td style="text-align:left;">
6 Nearest Neighbors, Rank weight, L2 distance
</td>
<td style="text-align:left;">
0.76315
</td>
</tr>
<tr>
<td style="text-align:left;">
Support Vector Machine with 2nd degree polynomial kernel
</td>
<td style="text-align:left;">
0.77272
</td>
</tr>
</tbody>
</table>
</div>
<div id="classification-trees-c5.0" class="section level3" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> Classification trees: C5.0</h3>
<p>For the rest of this chapter we will turn our attention to tree based models. The first model is a simple classification tree based on the C5.0 algorithm.</p>
<p>In general classification trees are highly flexible, deal with NAs quite easily and thus require very little preprocessing. To test this we will look at a few different light preprocessing recipes. One is the basic recipe. One adds decorrolation and one further imputes NAs:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="titanic---studies-on-classification.html#cb98-1" aria-hidden="true" tabindex="-1"></a>titanic_c50_rec <span class="ot">&lt;-</span> </span>
<span id="cb98-2"><a href="titanic---studies-on-classification.html#cb98-2" aria-hidden="true" tabindex="-1"></a>  titanic_baserec</span>
<span id="cb98-3"><a href="titanic---studies-on-classification.html#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="titanic---studies-on-classification.html#cb98-4" aria-hidden="true" tabindex="-1"></a>titanic_c50_impute_rec <span class="ot">&lt;-</span></span>
<span id="cb98-5"><a href="titanic---studies-on-classification.html#cb98-5" aria-hidden="true" tabindex="-1"></a>  titanic_c50_rec <span class="sc">%&gt;%</span> </span>
<span id="cb98-6"><a href="titanic---studies-on-classification.html#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb98-7"><a href="titanic---studies-on-classification.html#cb98-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>())</span></code></pre></div>
<p>For the model, we will use a decision tree with engine C5.0:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="titanic---studies-on-classification.html#cb99-1" aria-hidden="true" tabindex="-1"></a>titanic_c50_mod <span class="ot">&lt;-</span></span>
<span id="cb99-2"><a href="titanic---studies-on-classification.html#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">decision_tree</span>(<span class="at">min_n=</span><span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb99-3"><a href="titanic---studies-on-classification.html#cb99-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">&quot;C5.0&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb99-4"><a href="titanic---studies-on-classification.html#cb99-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>)</span></code></pre></div>
<p>Now we can define the workflow set for the different recipes:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="titanic---studies-on-classification.html#cb100-1" aria-hidden="true" tabindex="-1"></a>titanic_c50_wfs <span class="ot">&lt;-</span> </span>
<span id="cb100-2"><a href="titanic---studies-on-classification.html#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_set</span>(</span>
<span id="cb100-3"><a href="titanic---studies-on-classification.html#cb100-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">rec =</span> titanic_c50_rec,</span>
<span id="cb100-4"><a href="titanic---studies-on-classification.html#cb100-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">impute =</span> titanic_c50_impute_rec),</span>
<span id="cb100-5"><a href="titanic---studies-on-classification.html#cb100-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">models =</span> <span class="fu">list</span>(<span class="at">c50 =</span> titanic_c50_mod)</span>
<span id="cb100-6"><a href="titanic---studies-on-classification.html#cb100-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>With just a single tunable parameter, we rely on tidymodels to choose an appropriate grid of size 5 for the parameters.</p>
<p>We are now ready to fit at tune the various models:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="titanic---studies-on-classification.html#cb101-1" aria-hidden="true" tabindex="-1"></a>titanic_c50_control <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(</span>
<span id="cb101-2"><a href="titanic---studies-on-classification.html#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_pred =</span> <span class="cn">TRUE</span>,</span>
<span id="cb101-3"><a href="titanic---studies-on-classification.html#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_over =</span> <span class="st">&quot;everything&quot;</span>,</span>
<span id="cb101-4"><a href="titanic---studies-on-classification.html#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_workflow =</span> <span class="cn">TRUE</span></span>
<span id="cb101-5"><a href="titanic---studies-on-classification.html#cb101-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb101-6"><a href="titanic---studies-on-classification.html#cb101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-7"><a href="titanic---studies-on-classification.html#cb101-7" aria-hidden="true" tabindex="-1"></a>titanic_c50_results <span class="ot">&lt;-</span> </span>
<span id="cb101-8"><a href="titanic---studies-on-classification.html#cb101-8" aria-hidden="true" tabindex="-1"></a>  titanic_c50_wfs <span class="sc">%&gt;%</span> </span>
<span id="cb101-9"><a href="titanic---studies-on-classification.html#cb101-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_map</span>(</span>
<span id="cb101-10"><a href="titanic---studies-on-classification.html#cb101-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb101-11"><a href="titanic---studies-on-classification.html#cb101-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> titanic_folds,</span>
<span id="cb101-12"><a href="titanic---studies-on-classification.html#cb101-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> <span class="dv">5</span>,</span>
<span id="cb101-13"><a href="titanic---studies-on-classification.html#cb101-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> titanic_c50_control, </span>
<span id="cb101-14"><a href="titanic---studies-on-classification.html#cb101-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy,roc_auc),</span>
<span id="cb101-15"><a href="titanic---studies-on-classification.html#cb101-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb101-16"><a href="titanic---studies-on-classification.html#cb101-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## i 1 of 2 tuning:     rec_c50</code></pre>
<pre><code>## ✓ 1 of 2 tuning:     rec_c50 (31.3s)</code></pre>
<pre><code>## i 2 of 2 tuning:     impute_c50</code></pre>
<pre><code>## ✓ 2 of 2 tuning:     impute_c50 (36.3s)</code></pre>
<p>Let us have a plot of the fitted models and workflows:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="titanic---studies-on-classification.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(titanic_c50_results,<span class="at">rank_metric=</span><span class="st">&quot;accuracy&quot;</span>,<span class="at">select_best =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb106-2"><a href="titanic---studies-on-classification.html#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="fl">0.45</span>,<span class="at">label=</span> wflow_id), <span class="at">angle=</span><span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb106-3"><a href="titanic---studies-on-classification.html#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb106-4"><a href="titanic---studies-on-classification.html#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-103-1.png" width="672" />
Quite interestingly we see almost similar accuracy from the two workflows, but ROC is higher for the recipe without imputation. Thus, we will continue with this workflow.</p>
<p>Let us find the best tuning parameters with respect to accuracy:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="titanic---studies-on-classification.html#cb107-1" aria-hidden="true" tabindex="-1"></a>titanic_c50_best_parm <span class="ot">&lt;-</span></span>
<span id="cb107-2"><a href="titanic---studies-on-classification.html#cb107-2" aria-hidden="true" tabindex="-1"></a>   titanic_c50_results <span class="sc">%&gt;%</span> </span>
<span id="cb107-3"><a href="titanic---studies-on-classification.html#cb107-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">extract_workflow_set_result</span>(<span class="st">&quot;rec_c50&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb107-4"><a href="titanic---studies-on-classification.html#cb107-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select_best</span>(<span class="at">metric=</span><span class="st">&quot;roc_auc&quot;</span>)</span>
<span id="cb107-5"><a href="titanic---studies-on-classification.html#cb107-5" aria-hidden="true" tabindex="-1"></a>titanic_c50_best_parm</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   min_n .config             
##   &lt;int&gt; &lt;chr&gt;               
## 1     6 Preprocessor1_Model4</code></pre>
<p>So, the best tree has minimal node size 6.</p>
<p>We can now define best workflow and fit to the training data</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="titanic---studies-on-classification.html#cb109-1" aria-hidden="true" tabindex="-1"></a>titanic_c50_best_wf <span class="ot">&lt;-</span> titanic_c50_results <span class="sc">%&gt;%</span> </span>
<span id="cb109-2"><a href="titanic---studies-on-classification.html#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_workflow</span>(<span class="st">&quot;rec_c50&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb109-3"><a href="titanic---studies-on-classification.html#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(titanic_c50_best_parm)</span>
<span id="cb109-4"><a href="titanic---studies-on-classification.html#cb109-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-5"><a href="titanic---studies-on-classification.html#cb109-5" aria-hidden="true" tabindex="-1"></a>titanic_c50_best_mod <span class="ot">&lt;-</span> <span class="fu">fit</span>(titanic_c50_best_wf,titanic_train_model)</span>
<span id="cb109-6"><a href="titanic---studies-on-classification.html#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="titanic---studies-on-classification.html#cb109-7" aria-hidden="true" tabindex="-1"></a>titanic_c50_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(titanic_c50_best_mod,<span class="at">new_data=</span>titanic_test)</span></code></pre></div>
<p>We are now ready to write the predictions to a file and upload to Kaggle:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="titanic---studies-on-classification.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">PassengerId =</span> titanic_test<span class="sc">$</span>PassengerId,titanic_c50_pred) <span class="sc">%&gt;%</span> </span>
<span id="cb110-2"><a href="titanic---studies-on-classification.html#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Survived =</span> .pred_class) <span class="sc">%&gt;%</span> </span>
<span id="cb110-3"><a href="titanic---studies-on-classification.html#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;./titanic_c50_pred.csv&quot;</span>)</span></code></pre></div>
<p>The Kaggle score is 0.78468, which is quite interesting, since simple classification trees are usually weak learnes. This will make the next two sections, where we look at bagging and boosting trees quite interesting.</p>
<p>Lets us add the results to our table</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="titanic---studies-on-classification.html#cb111-1" aria-hidden="true" tabindex="-1"></a>results_table <span class="ot">&lt;-</span> results_table <span class="sc">%&gt;%</span> <span class="fu">add_row</span>(<span class="at">Model =</span> <span class="st">&quot;C5.0 classification tree with minimum leaf size 6&quot;</span>, <span class="at">Score=</span><span class="st">&quot;0.78468&quot;</span>)</span>
<span id="cb111-2"><a href="titanic---studies-on-classification.html#cb111-2" aria-hidden="true" tabindex="-1"></a>results_table <span class="sc">%&gt;%</span> <span class="fu">kbl</span>() <span class="sc">%&gt;%</span> <span class="fu">kable_material</span>(<span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>,<span class="st">&quot;hover&quot;</span>))</span></code></pre></div>
<table class=" lightable-material lightable-striped lightable-hover" style="font-family: &quot;Source Sans Pro&quot;, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Model
</th>
<th style="text-align:left;">
Score
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
L2-penalized Logistic Regression
</td>
<td style="text-align:left;">
0.76315
</td>
</tr>
<tr>
<td style="text-align:left;">
6 Nearest Neighbors, Rank weight, L2 distance
</td>
<td style="text-align:left;">
0.76315
</td>
</tr>
<tr>
<td style="text-align:left;">
Support Vector Machine with 2nd degree polynomial kernel
</td>
<td style="text-align:left;">
0.77272
</td>
</tr>
<tr>
<td style="text-align:left;">
C5.0 classification tree with minimum leaf size 6
</td>
<td style="text-align:left;">
0.78468
</td>
</tr>
</tbody>
</table>
</div>
<div id="bagged-tree-models-bagged-c5.0-and-random-forests" class="section level3" number="3.3.6">
<h3><span class="header-section-number">3.3.6</span> Bagged tree models: Bagged C5.0 and Random Forests</h3>
<p>After our initial tour de simple models, we will now turn our attention to ensemble learning methods. In this subsection we will investigate bagging methods for trees. Specifically we will have a look at traditional bagged C5.0 trees and Random Forests. Traditionally bagged trees have the disadvantage of generating a lot of correlated trees, which dilutes the advantages of ensembles a bit. By using random forests, this should be offset.</p>
<p>As for the simple classification C5.0 tree, bagged trees require very little preprocessing. To some extend, imputing missing values could lead to a difference in prediction. The Random Forest algorithm needs to have missing values imputed. Thus we will use a base recipe as well as the base recipe with imputation of missed values for preprocessing:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="titanic---studies-on-classification.html#cb112-1" aria-hidden="true" tabindex="-1"></a>titanic_bagged_rec <span class="ot">&lt;-</span> </span>
<span id="cb112-2"><a href="titanic---studies-on-classification.html#cb112-2" aria-hidden="true" tabindex="-1"></a>  titanic_baserec</span>
<span id="cb112-3"><a href="titanic---studies-on-classification.html#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="titanic---studies-on-classification.html#cb112-4" aria-hidden="true" tabindex="-1"></a>titanic_bagged_impute_rec <span class="ot">&lt;-</span></span>
<span id="cb112-5"><a href="titanic---studies-on-classification.html#cb112-5" aria-hidden="true" tabindex="-1"></a>  titanic_bagged_rec <span class="sc">%&gt;%</span> </span>
<span id="cb112-6"><a href="titanic---studies-on-classification.html#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb112-7"><a href="titanic---studies-on-classification.html#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>())</span></code></pre></div>
<p>For the model, we will use a decision tree with engine C5.0 or a random forest. Random forests will usually not overfit given a high number of trees. Thus we will not tune the number of trees:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="titanic---studies-on-classification.html#cb113-1" aria-hidden="true" tabindex="-1"></a>titanic_bagged_c50_mod <span class="ot">&lt;-</span></span>
<span id="cb113-2"><a href="titanic---studies-on-classification.html#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bag_tree</span>(<span class="at">min_n=</span><span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb113-3"><a href="titanic---studies-on-classification.html#cb113-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">&quot;C5.0&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb113-4"><a href="titanic---studies-on-classification.html#cb113-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>)</span>
<span id="cb113-5"><a href="titanic---studies-on-classification.html#cb113-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-6"><a href="titanic---studies-on-classification.html#cb113-6" aria-hidden="true" tabindex="-1"></a>titanic_rf_mod <span class="ot">&lt;-</span></span>
<span id="cb113-7"><a href="titanic---studies-on-classification.html#cb113-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="fu">tune</span>(),<span class="at">trees =</span> <span class="dv">1000</span>, <span class="at">min_n=</span><span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb113-8"><a href="titanic---studies-on-classification.html#cb113-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">&quot;ranger&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb113-9"><a href="titanic---studies-on-classification.html#cb113-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>)</span></code></pre></div>
<p>Now we can define the workflow set for the different recipes:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="titanic---studies-on-classification.html#cb114-1" aria-hidden="true" tabindex="-1"></a>titanic_bag_wfs <span class="ot">&lt;-</span> </span>
<span id="cb114-2"><a href="titanic---studies-on-classification.html#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_set</span>(</span>
<span id="cb114-3"><a href="titanic---studies-on-classification.html#cb114-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">impute =</span> titanic_bagged_impute_rec),</span>
<span id="cb114-4"><a href="titanic---studies-on-classification.html#cb114-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">models =</span> <span class="fu">list</span>(<span class="at">bag_c50 =</span> titanic_bagged_c50_mod)</span>
<span id="cb114-5"><a href="titanic---studies-on-classification.html#cb114-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb114-6"><a href="titanic---studies-on-classification.html#cb114-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-7"><a href="titanic---studies-on-classification.html#cb114-7" aria-hidden="true" tabindex="-1"></a>titanic_rf_wfs <span class="ot">&lt;-</span> </span>
<span id="cb114-8"><a href="titanic---studies-on-classification.html#cb114-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_set</span>(</span>
<span id="cb114-9"><a href="titanic---studies-on-classification.html#cb114-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">impute =</span>  titanic_bagged_impute_rec),</span>
<span id="cb114-10"><a href="titanic---studies-on-classification.html#cb114-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">models =</span> <span class="fu">list</span>(<span class="at">rf=</span> titanic_rf_mod)</span>
<span id="cb114-11"><a href="titanic---studies-on-classification.html#cb114-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb114-12"><a href="titanic---studies-on-classification.html#cb114-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-13"><a href="titanic---studies-on-classification.html#cb114-13" aria-hidden="true" tabindex="-1"></a>titanic_bagged_wfs <span class="ot">&lt;-</span> </span>
<span id="cb114-14"><a href="titanic---studies-on-classification.html#cb114-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(titanic_bag_wfs,titanic_rf_wfs)</span></code></pre></div>
<p>This time agian, we rely on tidymodels to choose an appropriate grid for the parameters.</p>
<p>We are now ready to fit and tune the various models:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="titanic---studies-on-classification.html#cb115-1" aria-hidden="true" tabindex="-1"></a>titanic_bagged_control <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(</span>
<span id="cb115-2"><a href="titanic---studies-on-classification.html#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_pred =</span> <span class="cn">TRUE</span>,</span>
<span id="cb115-3"><a href="titanic---studies-on-classification.html#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_over =</span> <span class="st">&quot;everything&quot;</span>,</span>
<span id="cb115-4"><a href="titanic---studies-on-classification.html#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_workflow =</span> <span class="cn">TRUE</span></span>
<span id="cb115-5"><a href="titanic---studies-on-classification.html#cb115-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb115-6"><a href="titanic---studies-on-classification.html#cb115-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-7"><a href="titanic---studies-on-classification.html#cb115-7" aria-hidden="true" tabindex="-1"></a>titanic_bagged_results <span class="ot">&lt;-</span> </span>
<span id="cb115-8"><a href="titanic---studies-on-classification.html#cb115-8" aria-hidden="true" tabindex="-1"></a>  titanic_bagged_wfs <span class="sc">%&gt;%</span> </span>
<span id="cb115-9"><a href="titanic---studies-on-classification.html#cb115-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_map</span>(</span>
<span id="cb115-10"><a href="titanic---studies-on-classification.html#cb115-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb115-11"><a href="titanic---studies-on-classification.html#cb115-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> titanic_folds,</span>
<span id="cb115-12"><a href="titanic---studies-on-classification.html#cb115-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> <span class="dv">16</span>,</span>
<span id="cb115-13"><a href="titanic---studies-on-classification.html#cb115-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> titanic_bagged_control, </span>
<span id="cb115-14"><a href="titanic---studies-on-classification.html#cb115-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy,roc_auc),</span>
<span id="cb115-15"><a href="titanic---studies-on-classification.html#cb115-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb115-16"><a href="titanic---studies-on-classification.html#cb115-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## i 1 of 2 tuning:     impute_bag_c50</code></pre>
<pre><code>## ✓ 1 of 2 tuning:     impute_bag_c50 (8m 56.2s)</code></pre>
<pre><code>## i 2 of 2 tuning:     impute_rf</code></pre>
<pre><code>## i Creating pre-processing data to finalize unknown parameter: mtry</code></pre>
<pre><code>## ✓ 2 of 2 tuning:     impute_rf (3m 18.6s)</code></pre>
<p>Let us have a plot of the fitted models and workflows:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="titanic---studies-on-classification.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(titanic_bagged_results,<span class="at">rank_metric=</span><span class="st">&quot;accuracy&quot;</span>,<span class="at">select_best =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb121-2"><a href="titanic---studies-on-classification.html#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="fl">0.65</span>,<span class="at">label=</span> wflow_id), <span class="at">angle=</span><span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb121-3"><a href="titanic---studies-on-classification.html#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y=</span><span class="fu">c</span>(<span class="fl">0.4</span>,<span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb121-4"><a href="titanic---studies-on-classification.html#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-112-1.png" width="672" />
We see that the Random Forest performs slightly better, when it comes to accuracy, than the bagged C5.0, though ROC seems almost similar. Moreover, when can see that the bagged C5.0 benefits slightly from imputation of missing values.</p>
<p>Let us find the best tuning parameters with respect to accuracy:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="titanic---studies-on-classification.html#cb122-1" aria-hidden="true" tabindex="-1"></a>titanic_bagged_best_parm <span class="ot">&lt;-</span></span>
<span id="cb122-2"><a href="titanic---studies-on-classification.html#cb122-2" aria-hidden="true" tabindex="-1"></a>   titanic_bagged_results <span class="sc">%&gt;%</span> </span>
<span id="cb122-3"><a href="titanic---studies-on-classification.html#cb122-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">extract_workflow_set_result</span>(<span class="st">&quot;impute_rf&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb122-4"><a href="titanic---studies-on-classification.html#cb122-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select_best</span>(<span class="at">metric=</span><span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb122-5"><a href="titanic---studies-on-classification.html#cb122-5" aria-hidden="true" tabindex="-1"></a>titanic_bagged_best_parm</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##    mtry min_n .config              
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;                
## 1     3     2 Preprocessor1_Model16</code></pre>
<p>We see that the best Random Forest workflow uses 3 randomly sampled predictors in each tree and minimum 2 data points in each splitting note.</p>
<p>We can now define best workflow and fit to the training data</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="titanic---studies-on-classification.html#cb124-1" aria-hidden="true" tabindex="-1"></a>titanic_bagged_best_wf <span class="ot">&lt;-</span> titanic_bagged_results <span class="sc">%&gt;%</span> </span>
<span id="cb124-2"><a href="titanic---studies-on-classification.html#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_workflow</span>(<span class="st">&quot;impute_rf&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb124-3"><a href="titanic---studies-on-classification.html#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(titanic_bagged_best_parm)</span>
<span id="cb124-4"><a href="titanic---studies-on-classification.html#cb124-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-5"><a href="titanic---studies-on-classification.html#cb124-5" aria-hidden="true" tabindex="-1"></a>titanic_bagged_best_mod <span class="ot">&lt;-</span> <span class="fu">fit</span>(titanic_bagged_best_wf,titanic_train_model)</span>
<span id="cb124-6"><a href="titanic---studies-on-classification.html#cb124-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-7"><a href="titanic---studies-on-classification.html#cb124-7" aria-hidden="true" tabindex="-1"></a>titanic_bagged_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(titanic_bagged_best_mod,<span class="at">new_data=</span>titanic_test)</span></code></pre></div>
<p>We are now ready to write the predictions to a file and upload to Kaggle:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="titanic---studies-on-classification.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">PassengerId =</span> titanic_test<span class="sc">$</span>PassengerId,titanic_bagged_pred) <span class="sc">%&gt;%</span> </span>
<span id="cb125-2"><a href="titanic---studies-on-classification.html#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Survived =</span> .pred_class) <span class="sc">%&gt;%</span> </span>
<span id="cb125-3"><a href="titanic---studies-on-classification.html#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;./titanic_bagged_pred.csv&quot;</span>)</span></code></pre></div>
<p>The Kaggle score is 0.76794, which remarkably is worse than for the single C5.0 tree. Lets try submitting the best bagged C5.0 results as well:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="titanic---studies-on-classification.html#cb126-1" aria-hidden="true" tabindex="-1"></a>titanic_bagged_c50_best_parm <span class="ot">&lt;-</span></span>
<span id="cb126-2"><a href="titanic---studies-on-classification.html#cb126-2" aria-hidden="true" tabindex="-1"></a>   titanic_bagged_results <span class="sc">%&gt;%</span> </span>
<span id="cb126-3"><a href="titanic---studies-on-classification.html#cb126-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">extract_workflow_set_result</span>(<span class="st">&quot;impute_bag_c50&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb126-4"><a href="titanic---studies-on-classification.html#cb126-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select_best</span>(<span class="at">metric=</span><span class="st">&quot;roc_auc&quot;</span>)</span>
<span id="cb126-5"><a href="titanic---studies-on-classification.html#cb126-5" aria-hidden="true" tabindex="-1"></a>titanic_bagged_c50_best_parm</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   min_n .config              
##   &lt;int&gt; &lt;chr&gt;                
## 1     7 Preprocessor1_Model02</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="titanic---studies-on-classification.html#cb128-1" aria-hidden="true" tabindex="-1"></a>titanic_bagged_c50_best_wf <span class="ot">&lt;-</span> titanic_bagged_results <span class="sc">%&gt;%</span> </span>
<span id="cb128-2"><a href="titanic---studies-on-classification.html#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_workflow</span>(<span class="st">&quot;impute_bag_c50&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-3"><a href="titanic---studies-on-classification.html#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(titanic_bagged_c50_best_parm)</span>
<span id="cb128-4"><a href="titanic---studies-on-classification.html#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="titanic---studies-on-classification.html#cb128-5" aria-hidden="true" tabindex="-1"></a>titanic_bagged_c50_best_mod <span class="ot">&lt;-</span> <span class="fu">fit</span>(titanic_bagged_c50_best_wf,titanic_train_model)</span>
<span id="cb128-6"><a href="titanic---studies-on-classification.html#cb128-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-7"><a href="titanic---studies-on-classification.html#cb128-7" aria-hidden="true" tabindex="-1"></a>titanic_bagged_c50_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(titanic_bagged_c50_best_mod,<span class="at">new_data=</span>titanic_test)</span>
<span id="cb128-8"><a href="titanic---studies-on-classification.html#cb128-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-9"><a href="titanic---studies-on-classification.html#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">PassengerId =</span> titanic_test<span class="sc">$</span>PassengerId,titanic_bagged_c50_pred) <span class="sc">%&gt;%</span> </span>
<span id="cb128-10"><a href="titanic---studies-on-classification.html#cb128-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Survived =</span> .pred_class) <span class="sc">%&gt;%</span> </span>
<span id="cb128-11"><a href="titanic---studies-on-classification.html#cb128-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;./titanic_bagged_c50_pred.csv&quot;</span>)</span></code></pre></div>
<p>The Kaggle score for the bagged C5.0 is 0.78708, and thus it outperforms the random forest. One might ask if the random forest actually is overfit, even though they should have a tendency to do so.</p>
<p>Lets us add the results to our table</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="titanic---studies-on-classification.html#cb129-1" aria-hidden="true" tabindex="-1"></a>results_table <span class="ot">&lt;-</span> results_table <span class="sc">%&gt;%</span> <span class="fu">add_row</span>(<span class="at">Model =</span> <span class="st">&quot;Random Forest with mtry=3 and min_n = 2&quot;</span>, <span class="at">Score=</span><span class="st">&quot;0.76794&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">add_row</span>(<span class="at">Model =</span> <span class="st">&quot;Bagged C5.0 minimum leaf size 7&quot;</span>, <span class="at">Score=</span><span class="st">&quot;0.78708&quot;</span>)</span>
<span id="cb129-2"><a href="titanic---studies-on-classification.html#cb129-2" aria-hidden="true" tabindex="-1"></a>results_table <span class="sc">%&gt;%</span> <span class="fu">kbl</span>() <span class="sc">%&gt;%</span> <span class="fu">kable_material</span>(<span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>,<span class="st">&quot;hover&quot;</span>))</span></code></pre></div>
<table class=" lightable-material lightable-striped lightable-hover" style="font-family: &quot;Source Sans Pro&quot;, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Model
</th>
<th style="text-align:left;">
Score
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
L2-penalized Logistic Regression
</td>
<td style="text-align:left;">
0.76315
</td>
</tr>
<tr>
<td style="text-align:left;">
6 Nearest Neighbors, Rank weight, L2 distance
</td>
<td style="text-align:left;">
0.76315
</td>
</tr>
<tr>
<td style="text-align:left;">
Support Vector Machine with 2nd degree polynomial kernel
</td>
<td style="text-align:left;">
0.77272
</td>
</tr>
<tr>
<td style="text-align:left;">
C5.0 classification tree with minimum leaf size 6
</td>
<td style="text-align:left;">
0.78468
</td>
</tr>
<tr>
<td style="text-align:left;">
Random Forest with mtry=3 and min_n = 2
</td>
<td style="text-align:left;">
0.76794
</td>
</tr>
<tr>
<td style="text-align:left;">
Bagged C5.0 minimum leaf size 7
</td>
<td style="text-align:left;">
0.78708
</td>
</tr>
</tbody>
</table>
</div>
<div id="boosted-tree-models-xgboost." class="section level3" number="3.3.7">
<h3><span class="header-section-number">3.3.7</span> Boosted tree models: XGBoost.</h3>
<p>In this final subsection of models we will have a look at a different class of ensemble methods. Where bagged trees rely on bootstrapping the data to build a host of trees, boosting relies on building trees, that capture the features that have not yet been explained by the previous models. Thus, boosting is an example of a slow learner. And just as in the real world, slow learning often proves to be the most efficient. We will here have a look at two algorithms. The first is XGBoost, well known for being one of the most efficient and successful classification algorithms. The downside is, that the algorithm has a wide range of tunable parameters, and thus it can be costly to fit to data. Thus, we will also take a look at lightGBM, which can be up to 7 times faster to fit and tune than XGBoost, but has a small risk of overfitting.</p>
<p>Reading the documentation for the engines, XGBoost requires factors to be dummy encoded and missing values to be imputed. This gives us the following recipe for the boosting models:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="titanic---studies-on-classification.html#cb130-1" aria-hidden="true" tabindex="-1"></a>titanic_boost_rec <span class="ot">&lt;-</span> titanic_baserec <span class="sc">%&gt;%</span> </span>
<span id="cb130-2"><a href="titanic---studies-on-classification.html#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb130-3"><a href="titanic---studies-on-classification.html#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb130-4"><a href="titanic---studies-on-classification.html#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())</span></code></pre></div>
<p>Now we can define the models:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="titanic---studies-on-classification.html#cb131-1" aria-hidden="true" tabindex="-1"></a>titanic_xgb_mod <span class="ot">&lt;-</span> <span class="fu">boost_tree</span>(<span class="at">trees=</span><span class="fu">tune</span>(),<span class="at">min_n=</span><span class="fu">tune</span>(),<span class="at">tree_depth=</span><span class="fu">tune</span>(),</span>
<span id="cb131-2"><a href="titanic---studies-on-classification.html#cb131-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">learn_rate =</span> <span class="fu">tune</span>(), <span class="at">loss_reduction =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb131-3"><a href="titanic---studies-on-classification.html#cb131-3" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb131-4"><a href="titanic---studies-on-classification.html#cb131-4" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">set_engine</span>(<span class="st">&quot;xgboost&quot;</span>)</span></code></pre></div>
<p>The associated grid is</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="titanic---studies-on-classification.html#cb132-1" aria-hidden="true" tabindex="-1"></a>titanic_boost_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">trees</span>(),<span class="fu">min_n</span>(),<span class="fu">tree_depth</span>(),</span>
<span id="cb132-2"><a href="titanic---studies-on-classification.html#cb132-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">learn_rate</span>(),<span class="fu">loss_reduction</span>(),<span class="at">levels=</span><span class="dv">5</span>) </span></code></pre></div>
<p>Now we can define the workflow sets:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="titanic---studies-on-classification.html#cb133-1" aria-hidden="true" tabindex="-1"></a>titanic_boost_wfs <span class="ot">&lt;-</span> </span>
<span id="cb133-2"><a href="titanic---studies-on-classification.html#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_set</span>(</span>
<span id="cb133-3"><a href="titanic---studies-on-classification.html#cb133-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">rec =</span>  titanic_boost_rec),</span>
<span id="cb133-4"><a href="titanic---studies-on-classification.html#cb133-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">models =</span> <span class="fu">list</span>(<span class="at">xgb=</span> titanic_xgb_mod)</span>
<span id="cb133-5"><a href="titanic---studies-on-classification.html#cb133-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>With a grid of size <span class="math inline">\(5^4=625\)</span> and relatively expensive models to fit, we will use tune_racing_anova to speed up the process. Tune_racing_anova is a method where is set of parameters is initially screened and obviously inefficient sets are discarded. Another option could have been to use a spacefilling grid instead of a regular grid.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="titanic---studies-on-classification.html#cb134-1" aria-hidden="true" tabindex="-1"></a>titanic_boost_control <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(</span>
<span id="cb134-2"><a href="titanic---studies-on-classification.html#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_pred =</span> <span class="cn">TRUE</span>,</span>
<span id="cb134-3"><a href="titanic---studies-on-classification.html#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallel_over =</span> <span class="st">&quot;everything&quot;</span>,</span>
<span id="cb134-4"><a href="titanic---studies-on-classification.html#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_workflow =</span> <span class="cn">TRUE</span></span>
<span id="cb134-5"><a href="titanic---studies-on-classification.html#cb134-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb134-6"><a href="titanic---studies-on-classification.html#cb134-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-7"><a href="titanic---studies-on-classification.html#cb134-7" aria-hidden="true" tabindex="-1"></a>titanic_boost_results <span class="ot">&lt;-</span> </span>
<span id="cb134-8"><a href="titanic---studies-on-classification.html#cb134-8" aria-hidden="true" tabindex="-1"></a>  titanic_boost_wfs <span class="sc">%&gt;%</span> </span>
<span id="cb134-9"><a href="titanic---studies-on-classification.html#cb134-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow_map</span>(</span>
<span id="cb134-10"><a href="titanic---studies-on-classification.html#cb134-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb134-11"><a href="titanic---studies-on-classification.html#cb134-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> titanic_folds,</span>
<span id="cb134-12"><a href="titanic---studies-on-classification.html#cb134-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> titanic_boost_grid,</span>
<span id="cb134-13"><a href="titanic---studies-on-classification.html#cb134-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> titanic_boost_control,</span>
<span id="cb134-14"><a href="titanic---studies-on-classification.html#cb134-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb134-15"><a href="titanic---studies-on-classification.html#cb134-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">objective =</span> <span class="st">&quot;binary:logistic&quot;</span>,</span>
<span id="cb134-16"><a href="titanic---studies-on-classification.html#cb134-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">eval_metric =</span> <span class="st">&quot;logloss&quot;</span></span>
<span id="cb134-17"><a href="titanic---studies-on-classification.html#cb134-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## i 1 of 1 tuning:     rec_xgb</code></pre>
<pre><code>## ✓ 1 of 1 tuning:     rec_xgb (4h 25m 9.9s)</code></pre>
<p>Let us have a plot of the fitted models and workflows:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="titanic---studies-on-classification.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(titanic_boost_results,<span class="at">rank_metric=</span><span class="st">&quot;accuracy&quot;</span>,<span class="at">select_best =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb137-2"><a href="titanic---studies-on-classification.html#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="fl">0.65</span>,<span class="at">label=</span> wflow_id), <span class="at">angle=</span><span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb137-3"><a href="titanic---studies-on-classification.html#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y=</span><span class="fu">c</span>(<span class="fl">0.4</span>,<span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb137-4"><a href="titanic---studies-on-classification.html#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-123-1.png" width="672" />
We see that both accuracy and ROC are in the same ballpark as for the other models. It will be interesting to see if the XGBoost is better at generalizing the results to the test data.</p>
<p>Let us find the best tuning parameters with respect to accuracy:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="titanic---studies-on-classification.html#cb138-1" aria-hidden="true" tabindex="-1"></a>titanic_boost_best_parm <span class="ot">&lt;-</span></span>
<span id="cb138-2"><a href="titanic---studies-on-classification.html#cb138-2" aria-hidden="true" tabindex="-1"></a>   titanic_boost_results <span class="sc">%&gt;%</span> </span>
<span id="cb138-3"><a href="titanic---studies-on-classification.html#cb138-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">extract_workflow_set_result</span>(<span class="st">&quot;rec_xgb&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb138-4"><a href="titanic---studies-on-classification.html#cb138-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select_best</span>(<span class="at">metric=</span><span class="st">&quot;accuracy&quot;</span>)</span>
<span id="cb138-5"><a href="titanic---studies-on-classification.html#cb138-5" aria-hidden="true" tabindex="-1"></a>titanic_boost_best_parm</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   trees min_n tree_depth learn_rate loss_reduction .config                
##   &lt;int&gt; &lt;int&gt;      &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;                  
## 1   500    11          4        0.1         0.0422 Preprocessor1_Model0867</code></pre>
<p>We see that the best results are obtained with 500 trees, minimum node size when splitting of 11, a tree depth of each tree of 4 and a learning rate of 0.1. The learning rate is seen to be lower than the default learning rate for the XGBoost engine of 0.3</p>
<p>We can now define best workflow and fit to the training data</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="titanic---studies-on-classification.html#cb140-1" aria-hidden="true" tabindex="-1"></a>titanic_boost_best_wf <span class="ot">&lt;-</span> titanic_boost_results <span class="sc">%&gt;%</span> </span>
<span id="cb140-2"><a href="titanic---studies-on-classification.html#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_workflow</span>(<span class="st">&quot;rec_xgb&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb140-3"><a href="titanic---studies-on-classification.html#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(titanic_boost_best_parm)</span>
<span id="cb140-4"><a href="titanic---studies-on-classification.html#cb140-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-5"><a href="titanic---studies-on-classification.html#cb140-5" aria-hidden="true" tabindex="-1"></a>titanic_boost_best_mod <span class="ot">&lt;-</span> <span class="fu">fit</span>(titanic_boost_best_wf,titanic_train_model)</span></code></pre></div>
<pre><code>## [15:56:48] WARNING: amalgamation/../src/learner.cc:1115: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective &#39;binary:logistic&#39; was changed from &#39;error&#39; to &#39;logloss&#39;. Explicitly set eval_metric if you&#39;d like to restore the old behavior.</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="titanic---studies-on-classification.html#cb142-1" aria-hidden="true" tabindex="-1"></a>titanic_boost_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(titanic_boost_best_mod,<span class="at">new_data=</span>titanic_test)</span></code></pre></div>
<p>We are now ready to write the predictions to a file and upload to Kaggle:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="titanic---studies-on-classification.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">PassengerId =</span> titanic_test<span class="sc">$</span>PassengerId,titanic_boost_pred) <span class="sc">%&gt;%</span> </span>
<span id="cb143-2"><a href="titanic---studies-on-classification.html#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Survived =</span> .pred_class) <span class="sc">%&gt;%</span> </span>
<span id="cb143-3"><a href="titanic---studies-on-classification.html#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;./titanic_boost_pred.csv&quot;</span>)</span></code></pre></div>
<p>The Kaggle score is 0.75837, which could indicate an overfitted model.</p>
<p>Lets us add the results to our table</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="titanic---studies-on-classification.html#cb144-1" aria-hidden="true" tabindex="-1"></a>results_table <span class="ot">&lt;-</span> results_table <span class="sc">%&gt;%</span> <span class="fu">add_row</span>(<span class="at">Model =</span> <span class="st">&quot;XGBoost with 500 trees, min_n=11 and tree_depth = 4, &quot;</span>, <span class="at">Score=</span><span class="st">&quot;0.75837&quot;</span>)</span>
<span id="cb144-2"><a href="titanic---studies-on-classification.html#cb144-2" aria-hidden="true" tabindex="-1"></a>results_table <span class="sc">%&gt;%</span> <span class="fu">kbl</span>() <span class="sc">%&gt;%</span> <span class="fu">kable_material</span>(<span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>,<span class="st">&quot;hover&quot;</span>))</span></code></pre></div>
<table class=" lightable-material lightable-striped lightable-hover" style="font-family: &quot;Source Sans Pro&quot;, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Model
</th>
<th style="text-align:left;">
Score
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
L2-penalized Logistic Regression
</td>
<td style="text-align:left;">
0.76315
</td>
</tr>
<tr>
<td style="text-align:left;">
6 Nearest Neighbors, Rank weight, L2 distance
</td>
<td style="text-align:left;">
0.76315
</td>
</tr>
<tr>
<td style="text-align:left;">
Support Vector Machine with 2nd degree polynomial kernel
</td>
<td style="text-align:left;">
0.77272
</td>
</tr>
<tr>
<td style="text-align:left;">
C5.0 classification tree with minimum leaf size 6
</td>
<td style="text-align:left;">
0.78468
</td>
</tr>
<tr>
<td style="text-align:left;">
Random Forest with mtry=3 and min_n = 2
</td>
<td style="text-align:left;">
0.76794
</td>
</tr>
<tr>
<td style="text-align:left;">
Bagged C5.0 minimum leaf size 7
</td>
<td style="text-align:left;">
0.78708
</td>
</tr>
<tr>
<td style="text-align:left;">
XGBoost with 500 trees, min_n=11 and tree_depth = 4,
</td>
<td style="text-align:left;">
0.75837
</td>
</tr>
</tbody>
</table>
<p>With this, we conclude the test of simple models. The best model was a bagged C5.0 tree with a score of 0.78708. This was achieved with a fairly simple preprocessing and CV-tuning of hyperparameters. Though acceptable, it is not sufficient to reach the desired score of at least 80%. Thus we will have to make a more refined model.</p>
</div>
</div>
<div id="improved-model-for-titanic-data" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Improved model for Titanic data</h2>
<p>In this section we will look at the preprocessing of data from the Titanic data set. In the simple models, we imputed fare and age by median values for the entire population and embark by mode. Though reasonable assumptions, we will have to improve at least on the age imputation. Moreover we will introduce new variables derived from the name column.</p>
<p>Let us start by loading the data again:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="titanic---studies-on-classification.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb145-2"><a href="titanic---studies-on-classification.html#cb145-2" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./titanic_train.csv&quot;</span>,<span class="at">show_col_types =</span> F)</span>
<span id="cb145-3"><a href="titanic---studies-on-classification.html#cb145-3" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./titanic_test.csv&quot;</span>,<span class="at">show_col_types =</span> F)</span></code></pre></div>
<p>First we will remove the <em>Ticket</em> and <em>Cabin</em> columns as well as change data type for passenger class, <em>Pclass</em>, and outcome varible, <em>Survived</em>. The same operations with the exception of the survived data, is done on the test data.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="titanic---studies-on-classification.html#cb146-1" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> train2 <span class="sc">%&gt;%</span> </span>
<span id="cb146-2"><a href="titanic---studies-on-classification.html#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Ticket =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb146-3"><a href="titanic---studies-on-classification.html#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Cabin =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb146-4"><a href="titanic---studies-on-classification.html#cb146-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survived =</span> <span class="fu">as_factor</span>(Survived)) <span class="sc">%&gt;%</span> </span>
<span id="cb146-5"><a href="titanic---studies-on-classification.html#cb146-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Pclass =</span> <span class="fu">as_factor</span>(Pclass))</span>
<span id="cb146-6"><a href="titanic---studies-on-classification.html#cb146-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-7"><a href="titanic---studies-on-classification.html#cb146-7" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> test2 <span class="sc">%&gt;%</span> </span>
<span id="cb146-8"><a href="titanic---studies-on-classification.html#cb146-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Ticket =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb146-9"><a href="titanic---studies-on-classification.html#cb146-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Cabin =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb146-10"><a href="titanic---studies-on-classification.html#cb146-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Pclass =</span> <span class="fu">as_factor</span>(Pclass))</span></code></pre></div>
<p>Next we will add a new variable <em>FamilySize</em> to the data sets. We distinguish between singles, couples, small families and large families. Singles are identified as having both <em>Parch</em> and <em>SibSp</em> equal to 0. Couples have <em>SibSp</em> equal to 1 and <em>Parch</em> equal to 0. Small familes have sum of <em>Parch</em> and <em>SipSp</em> less than 5 and large familes greater than 5:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="titanic---studies-on-classification.html#cb147-1" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> train2 <span class="sc">%&gt;%</span> </span>
<span id="cb147-2"><a href="titanic---studies-on-classification.html#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FamilySize =</span> SibSp <span class="sc">+</span> Parch) <span class="sc">%&gt;%</span> </span>
<span id="cb147-3"><a href="titanic---studies-on-classification.html#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Family =</span> <span class="fu">case_when</span>((SibSp <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Parch <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">&quot;Single&quot;</span>,</span>
<span id="cb147-4"><a href="titanic---studies-on-classification.html#cb147-4" aria-hidden="true" tabindex="-1"></a>                            (SibSp <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Parch <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">&quot;Couple&quot;</span>,</span>
<span id="cb147-5"><a href="titanic---studies-on-classification.html#cb147-5" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">between</span>(FamilySize,<span class="dv">1</span>,<span class="dv">5</span>) <span class="sc">~</span> <span class="st">&quot;Small&quot;</span>,</span>
<span id="cb147-6"><a href="titanic---studies-on-classification.html#cb147-6" aria-hidden="true" tabindex="-1"></a>                            SibSp<span class="sc">+</span>Parch <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">~</span><span class="st">&quot;Large&quot;</span>))</span>
<span id="cb147-7"><a href="titanic---studies-on-classification.html#cb147-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb147-8"><a href="titanic---studies-on-classification.html#cb147-8" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> test2 <span class="sc">%&gt;%</span> </span>
<span id="cb147-9"><a href="titanic---studies-on-classification.html#cb147-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FamilySize =</span> SibSp <span class="sc">+</span> Parch) <span class="sc">%&gt;%</span> </span>
<span id="cb147-10"><a href="titanic---studies-on-classification.html#cb147-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Family =</span> <span class="fu">case_when</span>((SibSp <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Parch <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">&quot;Single&quot;</span>,</span>
<span id="cb147-11"><a href="titanic---studies-on-classification.html#cb147-11" aria-hidden="true" tabindex="-1"></a>                            (SibSp <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> Parch <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">&quot;Couple&quot;</span>,</span>
<span id="cb147-12"><a href="titanic---studies-on-classification.html#cb147-12" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">between</span>((SibSp <span class="sc">+</span> Parch),<span class="dv">1</span>,<span class="dv">5</span>) <span class="sc">~</span> <span class="st">&quot;Small&quot;</span>,</span>
<span id="cb147-13"><a href="titanic---studies-on-classification.html#cb147-13" aria-hidden="true" tabindex="-1"></a>                            SibSp<span class="sc">+</span>Parch <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">~</span><span class="st">&quot;Large&quot;</span>))</span></code></pre></div>
<p>The next new variable is the <em>Title</em>. There are several titles for the passengers aboard
the Titanic, and some of the are only covering a very few people. Thus we will group the titles in fewer titles:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="titanic---studies-on-classification.html#cb148-1" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> train2 <span class="sc">%&gt;%</span> </span>
<span id="cb148-2"><a href="titanic---studies-on-classification.html#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Title =</span> <span class="fu">case_when</span>(</span>
<span id="cb148-3"><a href="titanic---studies-on-classification.html#cb148-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Mr.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Mr&quot;</span>,</span>
<span id="cb148-4"><a href="titanic---studies-on-classification.html#cb148-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Mrs.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Mrs&quot;</span>,</span>
<span id="cb148-5"><a href="titanic---studies-on-classification.html#cb148-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Ms.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Miss&quot;</span>,</span>
<span id="cb148-6"><a href="titanic---studies-on-classification.html#cb148-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Miss.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Miss&quot;</span>,</span>
<span id="cb148-7"><a href="titanic---studies-on-classification.html#cb148-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Master.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Master&quot;</span>,</span>
<span id="cb148-8"><a href="titanic---studies-on-classification.html#cb148-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Dr.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Doktor&quot;</span>,</span>
<span id="cb148-9"><a href="titanic---studies-on-classification.html#cb148-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Rev.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Mr&quot;</span>,</span>
<span id="cb148-10"><a href="titanic---studies-on-classification.html#cb148-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Mlle.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Miss&quot;</span>,</span>
<span id="cb148-11"><a href="titanic---studies-on-classification.html#cb148-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Mme.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Mrs&quot;</span>,</span>
<span id="cb148-12"><a href="titanic---studies-on-classification.html#cb148-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Sir.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Noble&quot;</span>,</span>
<span id="cb148-13"><a href="titanic---studies-on-classification.html#cb148-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Countess.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Noble&quot;</span>,</span>
<span id="cb148-14"><a href="titanic---studies-on-classification.html#cb148-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Lady.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Noble&quot;</span>,</span>
<span id="cb148-15"><a href="titanic---studies-on-classification.html#cb148-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Jonkheer.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Noble&quot;</span>,</span>
<span id="cb148-16"><a href="titanic---studies-on-classification.html#cb148-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Don.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Noble&quot;</span>,</span>
<span id="cb148-17"><a href="titanic---studies-on-classification.html#cb148-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Dona.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Noble&quot;</span>,</span>
<span id="cb148-18"><a href="titanic---studies-on-classification.html#cb148-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Col.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Military&quot;</span>,</span>
<span id="cb148-19"><a href="titanic---studies-on-classification.html#cb148-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Capt.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Military&quot;</span>,</span>
<span id="cb148-20"><a href="titanic---studies-on-classification.html#cb148-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Major.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Military&quot;</span>,</span>
<span id="cb148-21"><a href="titanic---studies-on-classification.html#cb148-21" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb148-22"><a href="titanic---studies-on-classification.html#cb148-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-23"><a href="titanic---studies-on-classification.html#cb148-23" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> test2 <span class="sc">%&gt;%</span> </span>
<span id="cb148-24"><a href="titanic---studies-on-classification.html#cb148-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Title =</span> <span class="fu">case_when</span>(</span>
<span id="cb148-25"><a href="titanic---studies-on-classification.html#cb148-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Mr.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Mr&quot;</span>,</span>
<span id="cb148-26"><a href="titanic---studies-on-classification.html#cb148-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Mrs.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Mrs&quot;</span>,</span>
<span id="cb148-27"><a href="titanic---studies-on-classification.html#cb148-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Ms.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Miss&quot;</span>,</span>
<span id="cb148-28"><a href="titanic---studies-on-classification.html#cb148-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Miss.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Miss&quot;</span>,</span>
<span id="cb148-29"><a href="titanic---studies-on-classification.html#cb148-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Master.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Master&quot;</span>,</span>
<span id="cb148-30"><a href="titanic---studies-on-classification.html#cb148-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Dr.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Doktor&quot;</span>,</span>
<span id="cb148-31"><a href="titanic---studies-on-classification.html#cb148-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Rev.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Mr&quot;</span>,</span>
<span id="cb148-32"><a href="titanic---studies-on-classification.html#cb148-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Mlle.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Miss&quot;</span>,</span>
<span id="cb148-33"><a href="titanic---studies-on-classification.html#cb148-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Mme.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Mrs&quot;</span>,</span>
<span id="cb148-34"><a href="titanic---studies-on-classification.html#cb148-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Sir.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Noble&quot;</span>,</span>
<span id="cb148-35"><a href="titanic---studies-on-classification.html#cb148-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Countess.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Noble&quot;</span>,</span>
<span id="cb148-36"><a href="titanic---studies-on-classification.html#cb148-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Lady.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Noble&quot;</span>,</span>
<span id="cb148-37"><a href="titanic---studies-on-classification.html#cb148-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Jonkheer.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Noble&quot;</span>,</span>
<span id="cb148-38"><a href="titanic---studies-on-classification.html#cb148-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Don.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Noble&quot;</span>,</span>
<span id="cb148-39"><a href="titanic---studies-on-classification.html#cb148-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Dona.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Noble&quot;</span>,</span>
<span id="cb148-40"><a href="titanic---studies-on-classification.html#cb148-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Col.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Military&quot;</span>,</span>
<span id="cb148-41"><a href="titanic---studies-on-classification.html#cb148-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Capt.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Military&quot;</span>,</span>
<span id="cb148-42"><a href="titanic---studies-on-classification.html#cb148-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(Name,<span class="fu">coll</span>(<span class="st">&quot;Major.&quot;</span>)) <span class="sc">~</span> <span class="st">&quot;Military&quot;</span>,</span>
<span id="cb148-43"><a href="titanic---studies-on-classification.html#cb148-43" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<p>The final new feature is the family name of the passengers. In the name column, the family name is located first and separated by a comma. Thus we will retrieve all characters before the comma in the name column. Finally we will remove redundant columns together with the name column:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="titanic---studies-on-classification.html#cb149-1" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> train2 <span class="sc">%&gt;%</span> </span>
<span id="cb149-2"><a href="titanic---studies-on-classification.html#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FamilyNameLoc =</span> <span class="fu">str_locate</span>(Name,<span class="st">&quot;,&quot;</span>)[,<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb149-3"><a href="titanic---studies-on-classification.html#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FamilyName =</span> <span class="fu">str_sub</span>(Name,<span class="dv">1</span>,FamilyNameLoc<span class="dv">-1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb149-4"><a href="titanic---studies-on-classification.html#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Name=</span><span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb149-5"><a href="titanic---studies-on-classification.html#cb149-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FamilyNameLoc =</span> <span class="cn">NULL</span>)</span>
<span id="cb149-6"><a href="titanic---studies-on-classification.html#cb149-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-7"><a href="titanic---studies-on-classification.html#cb149-7" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> test2 <span class="sc">%&gt;%</span> </span>
<span id="cb149-8"><a href="titanic---studies-on-classification.html#cb149-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FamilyNameLoc =</span> <span class="fu">str_locate</span>(Name,<span class="st">&quot;,&quot;</span>)[,<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb149-9"><a href="titanic---studies-on-classification.html#cb149-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FamilyName =</span> <span class="fu">str_sub</span>(Name,<span class="dv">1</span>,FamilyNameLoc<span class="dv">-1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb149-10"><a href="titanic---studies-on-classification.html#cb149-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Name=</span><span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb149-11"><a href="titanic---studies-on-classification.html#cb149-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FamilyNameLoc =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>With the new variables introduced, let us have a look at missing data for train set and test set:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="titanic---studies-on-classification.html#cb150-1" aria-hidden="true" tabindex="-1"></a>train2 <span class="sc">%&gt;%</span> </span>
<span id="cb150-2"><a href="titanic---studies-on-classification.html#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">which</span>(<span class="fu">colSums</span>(<span class="fu">is.na</span>(.))<span class="sc">&gt;</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb150-3"><a href="titanic---studies-on-classification.html#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.)))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##     Age Embarked
##   &lt;int&gt;    &lt;int&gt;
## 1   177        2</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="titanic---studies-on-classification.html#cb152-1" aria-hidden="true" tabindex="-1"></a>test2 <span class="sc">%&gt;%</span> </span>
<span id="cb152-2"><a href="titanic---studies-on-classification.html#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">which</span>(<span class="fu">colSums</span>(<span class="fu">is.na</span>(.))<span class="sc">&gt;</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb152-3"><a href="titanic---studies-on-classification.html#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.)))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##     Age  Fare
##   &lt;int&gt; &lt;int&gt;
## 1    86     1</code></pre>
<p>The missing age and fare data will be imputed by the mean of age and fare respectively for passengers from the train data with the same title.</p>
<p>We begin by making a table of mean age and mean fare for each title:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="titanic---studies-on-classification.html#cb154-1" aria-hidden="true" tabindex="-1"></a>Impute_table <span class="ot">&lt;-</span> train2 <span class="sc">%&gt;%</span> </span>
<span id="cb154-2"><a href="titanic---studies-on-classification.html#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Title) <span class="sc">%&gt;%</span> </span>
<span id="cb154-3"><a href="titanic---studies-on-classification.html#cb154-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_age=</span><span class="fu">mean</span>(Age,<span class="at">na.rm=</span>T),<span class="at">mean_fare=</span><span class="fu">mean</span>(Fare,<span class="at">na.rm=</span>T))</span></code></pre></div>
<p>The means are added to the data sets, missing values imputed and the the means are removed from the data sets again.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="titanic---studies-on-classification.html#cb155-1" aria-hidden="true" tabindex="-1"></a>train2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(train2,Impute_table,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;Title&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb155-2"><a href="titanic---studies-on-classification.html#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Age),mean_age,Age)) <span class="sc">%&gt;%</span></span>
<span id="cb155-3"><a href="titanic---studies-on-classification.html#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fare =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Fare),mean_fare,Fare)) <span class="sc">%&gt;%</span> </span>
<span id="cb155-4"><a href="titanic---studies-on-classification.html#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_age =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb155-5"><a href="titanic---studies-on-classification.html#cb155-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_fare =</span> <span class="cn">NULL</span>)</span>
<span id="cb155-6"><a href="titanic---studies-on-classification.html#cb155-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-7"><a href="titanic---studies-on-classification.html#cb155-7" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(test2,Impute_table,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;Title&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb155-8"><a href="titanic---studies-on-classification.html#cb155-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Age),mean_age,Age)) <span class="sc">%&gt;%</span></span>
<span id="cb155-9"><a href="titanic---studies-on-classification.html#cb155-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fare =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Fare),mean_fare,Fare)) <span class="sc">%&gt;%</span> </span>
<span id="cb155-10"><a href="titanic---studies-on-classification.html#cb155-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_age =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb155-11"><a href="titanic---studies-on-classification.html#cb155-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_fare =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>Let us do one final check that all missing values are gone:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="titanic---studies-on-classification.html#cb156-1" aria-hidden="true" tabindex="-1"></a>train2 <span class="sc">%&gt;%</span> </span>
<span id="cb156-2"><a href="titanic---studies-on-classification.html#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">which</span>(<span class="fu">colSums</span>(<span class="fu">is.na</span>(.))<span class="sc">&gt;</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb156-3"><a href="titanic---studies-on-classification.html#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.)))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   Embarked
##      &lt;int&gt;
## 1        2</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="titanic---studies-on-classification.html#cb158-1" aria-hidden="true" tabindex="-1"></a>test2 <span class="sc">%&gt;%</span> </span>
<span id="cb158-2"><a href="titanic---studies-on-classification.html#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">which</span>(<span class="fu">colSums</span>(<span class="fu">is.na</span>(.))<span class="sc">&gt;</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb158-3"><a href="titanic---studies-on-classification.html#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.)))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 0</code></pre>
<p>With this we are ready to do the actual modelling. With all the preprocessing already done, the recipe is very simple:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="titanic---studies-on-classification.html#cb160-1" aria-hidden="true" tabindex="-1"></a>imp_rec <span class="ot">&lt;-</span></span>
<span id="cb160-2"><a href="titanic---studies-on-classification.html#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(Survived <span class="sc">~</span> ., <span class="at">data=</span>train2) <span class="sc">%&gt;%</span> </span>
<span id="cb160-3"><a href="titanic---studies-on-classification.html#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(PassengerId,<span class="at">new_role=</span><span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb160-4"><a href="titanic---studies-on-classification.html#cb160-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(Embarked)</span></code></pre></div>
<p>We will only fit the bagged C5.0 models, since they did best for the simple preprocessing. Somehow R is having problems tuning the bagged C5.0 model with the data set at hand, so instead we will fit models with min_n ranging from 7 to 10.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="titanic---studies-on-classification.html#cb161-1" aria-hidden="true" tabindex="-1"></a>imp_bc50_7 <span class="ot">&lt;-</span> </span>
<span id="cb161-2"><a href="titanic---studies-on-classification.html#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bag_tree</span>(<span class="at">min_n=</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb161-3"><a href="titanic---studies-on-classification.html#cb161-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;C5.0&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb161-4"><a href="titanic---studies-on-classification.html#cb161-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>)</span>
<span id="cb161-5"><a href="titanic---studies-on-classification.html#cb161-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-6"><a href="titanic---studies-on-classification.html#cb161-6" aria-hidden="true" tabindex="-1"></a>imp_bc50_8 <span class="ot">&lt;-</span> </span>
<span id="cb161-7"><a href="titanic---studies-on-classification.html#cb161-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bag_tree</span>(<span class="at">min_n=</span><span class="dv">8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb161-8"><a href="titanic---studies-on-classification.html#cb161-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;C5.0&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb161-9"><a href="titanic---studies-on-classification.html#cb161-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>)</span>
<span id="cb161-10"><a href="titanic---studies-on-classification.html#cb161-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-11"><a href="titanic---studies-on-classification.html#cb161-11" aria-hidden="true" tabindex="-1"></a>imp_bc50_9 <span class="ot">&lt;-</span> </span>
<span id="cb161-12"><a href="titanic---studies-on-classification.html#cb161-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bag_tree</span>(<span class="at">min_n=</span><span class="dv">9</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb161-13"><a href="titanic---studies-on-classification.html#cb161-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;C5.0&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb161-14"><a href="titanic---studies-on-classification.html#cb161-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>)</span>
<span id="cb161-15"><a href="titanic---studies-on-classification.html#cb161-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-16"><a href="titanic---studies-on-classification.html#cb161-16" aria-hidden="true" tabindex="-1"></a>imp_bc50_10 <span class="ot">&lt;-</span> </span>
<span id="cb161-17"><a href="titanic---studies-on-classification.html#cb161-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bag_tree</span>(<span class="at">min_n=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb161-18"><a href="titanic---studies-on-classification.html#cb161-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;C5.0&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb161-19"><a href="titanic---studies-on-classification.html#cb161-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>)</span></code></pre></div>
<p>Let us define the workflow sets:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="titanic---studies-on-classification.html#cb162-1" aria-hidden="true" tabindex="-1"></a>imp_workflow_bc50_7 <span class="ot">&lt;-</span> </span>
<span id="cb162-2"><a href="titanic---studies-on-classification.html#cb162-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>(imp_rec,imp_bc50_7)</span>
<span id="cb162-3"><a href="titanic---studies-on-classification.html#cb162-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-4"><a href="titanic---studies-on-classification.html#cb162-4" aria-hidden="true" tabindex="-1"></a>imp_workflow_bc50_8 <span class="ot">&lt;-</span> </span>
<span id="cb162-5"><a href="titanic---studies-on-classification.html#cb162-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>(imp_rec,imp_bc50_8)</span>
<span id="cb162-6"><a href="titanic---studies-on-classification.html#cb162-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-7"><a href="titanic---studies-on-classification.html#cb162-7" aria-hidden="true" tabindex="-1"></a>imp_workflow_bc50_9 <span class="ot">&lt;-</span> </span>
<span id="cb162-8"><a href="titanic---studies-on-classification.html#cb162-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>(imp_rec,imp_bc50_9)</span>
<span id="cb162-9"><a href="titanic---studies-on-classification.html#cb162-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-10"><a href="titanic---studies-on-classification.html#cb162-10" aria-hidden="true" tabindex="-1"></a>imp_workflow_bc50_10 <span class="ot">&lt;-</span> </span>
<span id="cb162-11"><a href="titanic---studies-on-classification.html#cb162-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>(imp_rec,imp_bc50_10)</span></code></pre></div>
<p>We can now fit each of the models to the training data</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="titanic---studies-on-classification.html#cb163-1" aria-hidden="true" tabindex="-1"></a>imp_best_mod_bc50_7 <span class="ot">&lt;-</span> <span class="fu">fit</span>(imp_workflow_bc50_7,train2)</span>
<span id="cb163-2"><a href="titanic---studies-on-classification.html#cb163-2" aria-hidden="true" tabindex="-1"></a>imp_best_mod_bc50_8 <span class="ot">&lt;-</span> <span class="fu">fit</span>(imp_workflow_bc50_8,train2)</span>
<span id="cb163-3"><a href="titanic---studies-on-classification.html#cb163-3" aria-hidden="true" tabindex="-1"></a>imp_best_mod_bc50_9 <span class="ot">&lt;-</span> <span class="fu">fit</span>(imp_workflow_bc50_9,train2)</span>
<span id="cb163-4"><a href="titanic---studies-on-classification.html#cb163-4" aria-hidden="true" tabindex="-1"></a>imp_best_mod_bc50_10 <span class="ot">&lt;-</span> <span class="fu">fit</span>(imp_workflow_bc50_10,train2)</span>
<span id="cb163-5"><a href="titanic---studies-on-classification.html#cb163-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-6"><a href="titanic---studies-on-classification.html#cb163-6" aria-hidden="true" tabindex="-1"></a>imp_pred_bc50_7 <span class="ot">&lt;-</span> <span class="fu">predict</span>(imp_best_mod_bc50_7,<span class="at">new_data=</span>test2)</span>
<span id="cb163-7"><a href="titanic---studies-on-classification.html#cb163-7" aria-hidden="true" tabindex="-1"></a>imp_pred_bc50_8 <span class="ot">&lt;-</span> <span class="fu">predict</span>(imp_best_mod_bc50_8,<span class="at">new_data=</span>test2)</span>
<span id="cb163-8"><a href="titanic---studies-on-classification.html#cb163-8" aria-hidden="true" tabindex="-1"></a>imp_pred_bc50_9 <span class="ot">&lt;-</span> <span class="fu">predict</span>(imp_best_mod_bc50_9,<span class="at">new_data=</span>test2)</span>
<span id="cb163-9"><a href="titanic---studies-on-classification.html#cb163-9" aria-hidden="true" tabindex="-1"></a>imp_pred_bc50_10 <span class="ot">&lt;-</span> <span class="fu">predict</span>(imp_best_mod_bc50_10,<span class="at">new_data=</span>test2)</span></code></pre></div>
<p>We are now ready to write the predictions to a file and upload to Kaggle:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="titanic---studies-on-classification.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">PassengerId =</span> test2<span class="sc">$</span>PassengerId,imp_pred_bc50_7) <span class="sc">%&gt;%</span> </span>
<span id="cb164-2"><a href="titanic---studies-on-classification.html#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Survived =</span> .pred_class) <span class="sc">%&gt;%</span> </span>
<span id="cb164-3"><a href="titanic---studies-on-classification.html#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;./titanic_imp_pred_bc50_7.csv&quot;</span>)</span>
<span id="cb164-4"><a href="titanic---studies-on-classification.html#cb164-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">PassengerId =</span> test2<span class="sc">$</span>PassengerId,imp_pred_bc50_8) <span class="sc">%&gt;%</span> </span>
<span id="cb164-5"><a href="titanic---studies-on-classification.html#cb164-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Survived =</span> .pred_class) <span class="sc">%&gt;%</span> </span>
<span id="cb164-6"><a href="titanic---studies-on-classification.html#cb164-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;./titanic_imp_pred_bc50_8.csv&quot;</span>)</span>
<span id="cb164-7"><a href="titanic---studies-on-classification.html#cb164-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">PassengerId =</span> test2<span class="sc">$</span>PassengerId,imp_pred_bc50_9) <span class="sc">%&gt;%</span> </span>
<span id="cb164-8"><a href="titanic---studies-on-classification.html#cb164-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Survived =</span> .pred_class) <span class="sc">%&gt;%</span> </span>
<span id="cb164-9"><a href="titanic---studies-on-classification.html#cb164-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;./titanic_imp_pred_bc50_9.csv&quot;</span>)</span>
<span id="cb164-10"><a href="titanic---studies-on-classification.html#cb164-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">PassengerId =</span> test2<span class="sc">$</span>PassengerId,imp_pred_bc50_10) <span class="sc">%&gt;%</span> </span>
<span id="cb164-11"><a href="titanic---studies-on-classification.html#cb164-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Survived =</span> .pred_class) <span class="sc">%&gt;%</span> </span>
<span id="cb164-12"><a href="titanic---studies-on-classification.html#cb164-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="st">&quot;./titanic_imp_pred_bc50_10.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="summary" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Summary</h2>
</div>
<div id="shiny-classification-app" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Shiny classification app</h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="machine-learning-capstone-project.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ames-housing-data---regression-methods.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
